var contactsqlquery = ["SELECT @LIMIT ID, OG.UGC AS OGCode,OG.[Desc] AS OGName,AccNo,Status,Name,AMF.Abbrev,CSince AS [C_Ment_Since],",
        "OPhone AS [Office_Phone], HPhone AS [House_Phone], Mobile AS [Mobile_Phone], Fax, Email, Contact, Add1, Add2, Add3, Zip AS [Post_Code],",
        "(SELECT [Desc] FROM SGM WHERE GID=Country) As [Country],NRIC AS [IC_Reg_ID], DOB AS [Birthdate], Gender,",
        "(SELECT [Desc] FROM SGM WHERE GID=State) As [State],(SELECT [Desc] FROM SGM WHERE GID=G30) As [Type],(SELECT [Desc] FROM SGM WHERE GID=G31) As [Class],",
        "(SELECT [Desc] FROM SGM WHERE GID=G32) As [Industry], (SELECT [Desc] FROM SGM WHERE GID=G33) As [Nature], (SELECT [Desc] FROM SGM WHERE GID=G35) As [Incorporation], ",
        "(SELECT Name FROM AMF As [A] WHERE A.ID=AMF.Handler) As [Sales],( SELECT Name FROM AMF As [A] WHERE A.ID=AMF.Asst) As [Asst_Sales],(SELECT AccNo FROM AMF As [A] ",
        "WHERE A.ID=AMF.RefAct) As [Referral], (SELECT AccNo FROM AMF As [A] WHERE A.ID=AMF.IntroducerID) As [Introducer],(SELECT AccNo FROM AMF As [A] ",
        "WHERE A.ID=AMF.HoldAccID) As [Holding],CurrCode AS [Currency_Code], Notes, Occupation AS [Position], Salutation, AcctContact AS [Billing_Contact],(SELECT [Desc] ",
        "FROM SGM WHERE GID=G101) As [Credit_Terms],CrLimit As [Credit_Limit],TaxNo As [Tax_No], (SELECT Abbrev FROM SGM WHERE GID=T1In) As [InTax_Code],",
        "(SELECT Abbrev FROM SGM WHERE GID=T1Out) As [OutTax_Code],GSTSBNo As [SelfBill_No],GstSBEff As [SelfBill_Effective],  GstSBExp As [SelfBill_Expiry],GstRegDT As [Gst_Reg_Date],",
        "BActNo1 As [BankAcc1],BActNo2 As [BankAcc2],(SELECT [Desc] FROM SGM WHERE GID=G36) As [NRIC_Type] ", "FROM AMF LEFT JOIN SGM OG ON AMF.OGID=OG.GID ",
        "LEFT JOIN SGM CT ON CT.GID = AMF.G30  WHERE @LastSync CT.[Desc] = 'Customer' ORDER BY ID "].join('');

var itemsqlquery = ["SELECT @LIMIT ID, OG.UGC AS OGCode,OG.[Desc] AS OGName,Code,Barcode,Name,(SELECT UGC FROM SGM WHERE GID=UOM) As [UOM],(SELECT [Desc] FROM SGM WHERE GID=G230) As [Class], ",
        "(SELECT [Desc] FROM SGM WHERE GID=G234) As [Brand],Remarks As [Notes],DiluteX AS Before_Diluted,(SELECT UGC FROM SGM WHERE GID=UOMDX) As [UOM_Before_Diluted],",
        " DiluteY AS After_Diluted,(SELECT UGC FROM SGM WHERE GID=UOMDY) As [UOM_After_Diluted],Reorder AS Low_Qty,(CASE WHEN WithSerial=1 THEN 'Yes' ELSE 'No' END) AS Serial,PurchaseInfo, ",
        " (SELECT [Desc] FROM SGM WHERE GID=G233) As [Costing],Model,(SELECT UGC FROM SGM WHERE GID=AssetGL) As [AssetGL],(SELECT UGC FROM SGM WHERE GID=IncomeGL) As [IncomeGL], ",
        " (SELECT UGC FROM SGM WHERE GID=ExpenseGL) As [ExpenseGL],(SELECT UGC FROM SGM WHERE GID=CostGL) As [CostGL],(SELECT Abbrev FROM SGM WHERE GID=T1In) As [InTax1], ",
        " (SELECT Abbrev FROM SGM WHERE GID=T1G60) As [OutTax1] FROM PDS LEFT JOIN SGM OG ON PDS.OGID=OG.GID @LastSync ORDER BY ID "].join('');

var subcontactsqlquery = ["",
        "SELECT distinct @LIMIT AML.ID, OG.UGC AS OGCode,OG.[Desc] AS OGName, AMF.AccNo,AMF.Name,AML.Code As [Site_Code],AML.Name As [Site_Name],",
        "(SELECT [Desc] FROM SGM WHERE GID=AML.G205) As [Premise_Type],(SELECT [Desc] FROM SGM WHERE GID=AML.G216) As [Salutation],AML.Status,AML.Contact,",
        "AML.ContactAsst,AML.Position,AML.Gender,AML.Add1,AML.Add2,AML.Add3,AML.Zip As [Post_Code],(SELECT [Desc] FROM SGM WHERE GID=AML.State) As [State],",
        "(SELECT [Desc] FROM SGM WHERE GID=AML.Country) As [Country],(SELECT UGC FROM SGM WHERE GID=AML.LUAID) As [Zone],AML.PhO As [Office_Phone],AML.PhH As [House_Phone],",
        "AML.PhM As [Mobile_Phone],AML.Fax,AML.Email,AML.WebSite FROM AMF INNER JOIN AML ON AMF.ID=AML.AccID LEFT JOIN SGM OG ON AMF.OGID=OG.GID  ",
        "LEFT JOIN SGM CT ON CT.GID = AMF.G30 "," WHERE @LastSync CT.[Desc] = 'Customer' ORDER BY AML.ID, AMF.AccNo,AMF.Name "].join('');

var tradesqlquery = [ "SELECT @LIMIT ID, InputDT, TrxDT, OGCode,OGName, UpdateDT, Z_ODisc, DocType as Doc_Type, UDNo as Doc_No, RefNo as RefNo, AccNo as AccNo, AcctName as Name, TrxDT as DocDT," ,
            "CCID as Currency, ex_rate, PymtTermsAbbrev as Terms, Z_Desc as Trx_Desc, Z_Code as Item,  ",
            "Z_Qty as Qty, Z_OPrice as Price, Z_OAmt as Amount, Z_Tax1 as Tax1, Z_Tax1Pct as Tax1_Rate, Z_OTax1 as Tax1_Amount, ",
            "Z_UOM, Status, OldUDNo as XDoc_No FROM ( SELECT OG.UGC as OGCode, OG.[Desc] as OGName, TSTF.UpdateDT, TSTF.OGID,TSTF.ID,TSTF.CMFID,TSTF.DONo,TSTF.CustRef, TSTF.RefNo,TSTF.Header,TSTF.Remarks,",
            "TSTF.DONotes,TSTF.PhO,TSTF.PhH,TSTF.PhM,TSTF.Fax,TSTF.Email,TSTF.Contact,TSTF.Info,TSTF.Info2,TSTF.Rating,TSTF.DelDT,TSTF.StartDT,TSTF.EndDT,TSTF.Period,TSTF.Narration,",
            "ISNULL(A.InputDT,TSTF.InputDT) AS InputDT, ISNULL(A.ER,1) AS ex_rate,TSTF.EnterBy,TSTF.FeedBack,TSTF.DelNo,TSTF.IsBadDebt,TSTF.GstDT,TSTF.GSTIncl,TSTF.GstSimp,TSTF.GstSBNo,TXDT.TrxDT,(CASE WHEN TSTF.G2=49 THEN 1 ELSE 0 END) As [GstGift],",
            "TSTF.G2 As [DocG2],TSTF.Duration/60 As [Duration],OTSTF.UDNo As [OldUDNo],CMF.UDNo+'/'+RIGHT('00'+CAST((SELECT COUNT(*) FROM CLD D WHERE D.CMFID=CMF.ID AND D.ID<=CLD.ID) AS VARCHAR),2) ",
            "As [SetUDNo],OTSTF.GstDT As [OldGstDT],OTSTF.TrxDT As [OldTrxDT],OTSTF.OAmt As [OldOAmt],OTSTF.CCID As [OldCCID],CMF.EffDT,CMF.ExpDT,CMF.RenNo,CMF.CustName As [Customer],CMF.UDNo As ",
            "[Contract_No],CMF.Remarks As [Title],AMF1.Name As [SalesName],AMF1.Abbrev As [SalesA],S16.[Desc] As [OrderStatus],S20.[Desc] As [OrderType],S20.Abbrev As [OrderTypeAbbrev],S20.UGC As ",
            "[OrderTypeUGC],CLD.RetentionP,CLD.CommP,CLD.OComm,CLD.LComm,CLD.OAmt As [OrderSetAmt],CLD.Title As [OrderSetTitle],CLD.Billing As [PaymentFreq],CLD.Freq,S12.[Desc] As ",
            "[PaymentMode],SAL.G216Desc As [Salutation],SAL.G205Desc As [PremiseType],REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE('[Add1]'+' '+'[Add2]'+' '+'[Add3]'+' ",
            "'+'[ZIP] [State]'+' '+'[Country].','[Add1]',ISNULL(CLD.Add1,'')),'[Add2]',ISNULL(CLD.Add2,'')),'[Add3]',ISNULL(CLD.Add3,'')),'[State]',ISNULL(S14.[Desc],'')),'[Zip]',ISNULL(CLD.Zip,'')), ",
            "'[Country]',ISNULL(S14CT.[Desc],'')),''+' '+''+' '+''+' '+'',''+' '+''),''+' '+''+' '+'',''+' '+''),''+' '+'','Â '+' '+'') As [LocAddress],dbo.GetDeliverables(CLD.ID) As ",
            " [Deliverables],AB.UDNo As [AutoBillTempNo],CASE TSTF.SS WHEN 'P' THEN (CASE WHEN TSTF.TS='C' THEN 'Cancelled' ELSE 'Posted' END) WHEN 'C' THEN 'Cancelled' WHEN 'T' THEN 'Template' ELSE ",
            "(CASE WHEN TSTF.TS='D' THEN 'Draft' ELSE 'Active' END) END As [Status],CAST(0 AS MONEY)OTInMinute,CAST(0 AS MONEY)OTInMinuteHoliday,DATENAME(dw,TSTF.StartDT) As [WeekDayName],(CASE WHEN ",
            "(SELECT COUNT(*) FROM HOL WHERE HOL.Title NOT IN('Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday') AND TSTF.StartDT>=HOL.StartDT AND ",
            "HOL.EndDT>=dbo.dateserial(DAY(TSTF.StartDT),MONTH(TSTF.StartDT),YEAR(TSTF.StartDT)))>0 THEN 1 ELSE 0 END) As [IsHoliday],S.[Desc] As [Status2],S1.[Desc] As [ServiceNature],S2.[Desc] As ",
            "[WorkType],S3.[Desc] As [StockNoteType],A.GLID,A.PDDT As [DueDT],S15.[UGC] As [GLCode],S15.[Desc] As [GLName],(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN 1 ELSE 0 END) AS IsNegate, ",
            "S13.[Desc] As [DocType],(CASE WHEN S13.SCC LIKE '%S%' THEN 1 WHEN S3.SCC LIKE '%S%' THEN 1 ELSE 0 END) As [ForSales],(CASE WHEN S13.SCC LIKE '%O%' THEN 1 WHEN S3.SCC LIKE '%O%' THEN 1 ",
            "ELSE 0 END) As [ForPurchase],S17.[Desc] As [PymtTerms],S17.Abbrev As [PymtTermsAbbrev],(CASE COALESCE(TSTD.SCC,'') WHEN '' THEN 'Bill Items' WHEN 'S' THEN 'Servicing' WHEN 'T' THEN ",
            "'Tracking' WHEN 'P' THEN 'Payment' ELSE 'Unknown' END) As [Z_TypeDesc],COALESCE(TSTD.SCC,'A') As [Z_Type],TSTD.ID As [Z_ID],TSTD.[Desc] As [Z_Desc],TSTD.Qty As [Z_Qty],TSTD.LastQty As ",
            "[Z_LastQty],TSTD.Qty-ISNULL(TSTD.LastQty,'') As [Z_UsageQty],TSTD.StockID As [Z_StockID],TSTD.RefNo As [Z_RefNo],TSTD.Rates As [Z_Rates],TSTD.ETA As [Z_ETA],TSTD.Tag As ",
            "[Z_Tag],TSTD.BatchNo As [Z_BatchNo],BT.TrxDT As [Z_BatchDT],BT.GstDT As [Z_GstDT],BT.OAmt As [Z_BatchOAmt],BT.LAmt As [Z_BatchLAmt],TSTD.StartDT As [Z_StartDT],TSTD.EndDT As ",
            "[Z_EndDT],TSTD.Duration/60 As [Z_Duration],TSTD.CommPct As [Z_CommPct],TSTD.DiscPct As [Z_DiscPct],TSTD.Tax1Pct As [Z_Tax1Pct],TSTD.Tax2Pct As [Z_Tax2Pct],S4.[UGC] As [Z_UOM],S5.[Desc] As ",
            "[Z_Status],S6.[Desc] As [Z_Action],S7.[Desc] As [Z_Area],S8.[Desc] As [Z_Target],S9.[UGC] As [Z_GLCode],S9.[Desc] As [Z_GLName],S9T.[Desc] As [Z_GLType],(CASE WHEN S9T.SCC LIKE '%A%' THEN ",
            " 1 ELSE 0 END) As [Z_IsCapital],PDS.Name As [Z_Name],PDS.Code As [Z_Code],PDS.BarCode As [Z_BarCode],S58.UGC As [StockTariffCode],S58.[Desc] As [StockTariffDesc],S10.[Desc] As ",
            "[Z_StockType],S10.SCC As [Z_StockSCC],S11.[Desc] As [Z_StockNoteType],Z.Route, Z.Zone, ISNULL(Z.Route + ' - ','') + ISNULL(Z.Zone,'') AS RouteZone, Z.RouteAbbrev, Z.ZoneUGC, Z.ZoneAbbrev,",
            "Z.ZoneState, Z.ZoneStateAbbrev,OG1.[Desc] As [OG_Name],OG2.[Desc] As [OG_Name_Order],OG3.[Desc] As [OG_Name_OrderSet],(CASE WHEN LEN(ISNULL(Tech.TechName,''))>0 THEN ",
            "LEFT(ISNULL(Tech.TechName,' '), LEN(ISNULL(Tech.TechName,' '))-1) ELSE '' END) As [TechName],B.LastARAP_Date,S31.[Desc] As [Account_Type],S35.[Desc] As [Acct_Inc],S35.UGC As ",
            "[Acct_Inc_UGC],(CASE WHEN AMF.Name LIKE '%takaful%' THEN 1 ELSE 0 END) As [Takaful],H.Name as HandlerName,TSTF.PostHandler, ",
            "(CASE WHEN TXDT.IsIM=1 THEN OTSTF.UDNo+'(K1)' ELSE (CASE WHEN ISNULL(STK.IsDO,0)=1 THEN TSTD.BatchNo ELSE (CASE WHEN LEN(TSTF.DONo)>0 AND TSTF.G2=80 THEN TSTF.DONo ELSE TSTF.UDNo END) END) ",
            "END) AS UDNo,(CASE WHEN TXDT.IsIM=1 THEN OTSTF.AcctID ELSE TSTF.AcctID END) AS AcctID,(CASE WHEN TXDT.IsIM=1 THEN OTSTF.AcctName ELSE TSTF.AcctName END) AS AcctName,(CASE WHEN TXDT.IsIM=1 ",
            "THEN OTSTF.CCID ELSE TSTF.CCID END) AS CCID,TXDT.GstRef, (CASE WHEN TXDT.IsIM=1 THEN OAMF.AccNo ELSE AMF.AccNo END) AS AccNo,(CASE WHEN TXDT.IsIM=1 THEN OAMF.NRIC ELSE AMF.NRIC END) AS ",
            "NRIC,(CASE WHEN TXDT.IsIM=1 THEN OAMF.OldNRIC ELSE AMF.OldNRIC END) AS OldNRIC,(CASE WHEN TXDT.IsIM=1 THEN OAMF.TaxNo ELSE AMF.TaxNo END) AS TaxNo,(CASE WHEN TXDT.IsIM=1 THEN OAMF.Email ",
            "ELSE AMF.Email END) AS MailTo,(CASE WHEN TXDT.IsIM=1 THEN S23.[Desc] ELSE S25.[Desc] END) AS ContactState,(CASE WHEN TXDT.IsIM=1 THEN S24.[Desc] ELSE S26.[Desc] END) AS ",
            "ContactCountry,(CASE WHEN TXDT.IsIM=1 THEN (CASE WHEN OAMF.G31=311 THEN OAMF.NRIC ELSE '' END) ELSE (CASE WHEN AMF.G31=311 THEN AMF.NRIC ELSE '' END) END) AS BusReg, ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTF.OAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS OAmt,(CASE WHEN ",
            "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTF.LAmt As [LAmt], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTF.OGross/(CASE WHEN TXDT.IsIM=1 ",
            "AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS OGross,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTF.LGross As [LGross], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTF.OAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS OAmtN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTF.LAmt As [LAmtN], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTF.OGross/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS OGrossN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTF.LGross As [LGrossN], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*A.OXAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS OS_OAmt,(CASE WHEN ",
            "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*A.LXAmt As [OS_LAmt], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 ",
            "THEN -1 ELSE 1 END)*A.OXAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS OS_OAmtN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN ",
            "PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*A.LXAmt As [OS_LAmtN], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*B.OXAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 ",
            "THEN OTSTF.ER ELSE 1 END),2) AS OSAsAt_OAmt,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*B.LXAmt As [OSAsAt_LAmt], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*B.OXAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS OSAsAt_OAmtN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*B.LXAmt As ",
            "[OSAsAt_LAmtN], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.OAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OAmt,(CASE WHEN ",
            "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LAmt As [Z_LAmt], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.OPrice/(CASE WHEN TXDT.IsIM=1 ",
            "AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OPrice,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LPrice As [Z_LPrice],",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS Z_OAmtN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LAmt As [Z_LAmtN],",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OPrice/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS Z_OPriceN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LPrice As [Z_LPriceN], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.ODisc/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_ODisc,(CASE WHEN ",
            "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LDisc As [Z_LDisc], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.OComm/(CASE WHEN TXDT.IsIM=1 ",
            "AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OComm,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LComm As [Z_LComm], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.ODisc/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS Z_ODiscN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LDisc As [Z_LDiscN], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OComm/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS Z_OCommN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LComm As [Z_LCommN], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.OTax1/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax1,(CASE WHEN ",
            "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LTax1 As [Z_LTax1], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.OTax2/(CASE WHEN TXDT.IsIM=1 ",
            "AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax2,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LTax2 As [Z_LTax2], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR ",
            "TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OTax1/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax1N,(CASE ",
            "WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LTax1 As [Z_LTax1N], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR ",
            "TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OTax2/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax2N,(CASE ",
            "WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LTax2 As [Z_LTax2N], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR ",
            "TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OTax1/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS ",
            "Z_OTax1N_GST03,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LTax1 As [Z_LTax1N_GST03], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OTax2/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS Z_OTax2N_GST03,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LTax2 As ",
            "[Z_LTax2N_GST03], S21.Abbrev As [Z_Tax1],S21.[Desc] As [Z_Tax1Desc],(CASE WHEN S21.SCC LIKE '%I%' THEN 1 ELSE 0 END) As [Z_Tax1_InputTax],(CASE WHEN S21.SCC LIKE '%O%' THEN 1 ELSE 0 END) ",
            "As [Z_Tax1_OutputTax],(CASE WHEN S21.SCC LIKE '%R%' THEN 1 ELSE 0 END) As [Z_Tax1_IRR_Supply],(CASE WHEN S21.SCC LIKE '%E%' THEN 1 ELSE 0 END) As [Z_Tax1_IRR_Exempt],(CASE WHEN S21.SCC ",
            "LIKE '%U%' THEN 1 ELSE 0 END) As [Z_Tax1_IRR_Residual],T1.TaxGLCode As [Z_Tax1Code],T1.TaxGLName As [Z_Tax1Name], S22.Abbrev As [Z_Tax2],S22.[Desc] As [Z_Tax2Desc],(CASE WHEN S22.SCC LIKE ",
            "'%I%' THEN 1 ELSE 0 END) As [Z_Tax2_InputTax],(CASE WHEN S22.SCC LIKE '%O%' THEN 1 ELSE 0 END) As [Z_Tax2_OutputTax],(CASE WHEN S22.SCC LIKE '%R%' THEN 1 ELSE 0 END) As [Z_Tax2_IRR_Supply],",
            "(CASE WHEN S22.SCC LIKE '%E%' THEN 1 ELSE 0 END) As [Z_Tax2_IRR_Exempt], (CASE WHEN S22.SCC LIKE '%U%' THEN 1 ELSE 0 END) As [Z_Tax2_IRR_Residual],T2.TaxGLCode As [Z_Tax2Code],T2.TaxGLName ",
            "As [Z_Tax2Name], CAST(1 AS FLOAT) As [Z_IRR], ROUND((CASE WHEN TXDT.IsIM=1 THEN TT.Z_OTotalTax1X ELSE TT.Z_OTotalTax1 END)/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 ",
            " END),2) AS Z_OTotalTax1,(CASE WHEN TXDT.IsIM=1 THEN TT.Z_LTotalTax1X ELSE TT.Z_LTotalTax1 END) AS Z_LTotalTax1, ROUND((CASE WHEN TXDT.IsIM=1 THEN TT.Z_OTotalTax2X ELSE TT.Z_OTotalTax2 ",
            "END)/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTotalTax2,(CASE WHEN TXDT.IsIM=1 THEN TT.Z_LTotalTax2X ELSE TT.Z_LTotalTax2 END) AS Z_LTotalTax2, ROUND((CASE ",
            "WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(CASE WHEN TXDT.IsIM=1 THEN TT.Z_OTotalTax1X ELSE TT.Z_OTotalTax1 ",
            "END)/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTotalTax1N,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 ",
            "THEN -1 ELSE 1 END)*(CASE WHEN TXDT.IsIM=1 THEN TT.Z_LTotalTax1X ELSE TT.Z_LTotalTax1 END) As [Z_LTotalTax1N], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 ",
            " END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(CASE WHEN TXDT.IsIM=1 THEN TT.Z_OTotalTax2X ELSE TT.Z_OTotalTax2 END)/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) ",
            "AS Z_OTotalTax2N,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(CASE WHEN TXDT.IsIM=1 THEN TT.Z_LTotalTax2X ",
            "ELSE TT.Z_LTotalTax2 END) As [Z_LTotalTax2N], ROUND((T1.OTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG1.OTaxTAmt ELSE TG1.OTaxTAmtX END),0))/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS Z_OTax1Sum,T1.LTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG1.LTaxTAmt ELSE TG1.LTaxTAmtX END),0) As [Z_LTax1Sum], ROUND((T2.OTaxTAmt-ISNULL((CASE WHEN ",
            "TXDT.IsIM=1 THEN TG2.OTaxTAmt ELSE TG2.OTaxTAmtX END),0))/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax2Sum,T2.LTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN ",
            "TG2.LTaxTAmt ELSE TG2.LTaxTAmtX END),0) As [Z_LTax2Sum], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 ",
            "END)*(T1.OTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG1.OTaxTAmt ELSE TG1.OTaxTAmtX END),0))/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax1SumN,(CASE WHEN ",
            "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(T1.LTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG1.LTaxTAmt ELSE ",
            "TG1.LTaxTAmtX END),0)) As [Z_LTax1SumN], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(T2.OTaxTAmt - ",
            "ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG2.OTaxTAmt ELSE TG2.OTaxTAmtX END),0))/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax2SumN,(CASE WHEN ",
            "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(T2.LTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG2.LTaxTAmt ELSE ",
            "TG2.LTaxTAmtX END),0)) As [Z_LTax2SumN] ,(CASE WHEN S9.GID>0 THEN (CASE WHEN S9.GID=S18.GID THEN S18.UGC ELSE S19.UGC END) ELSE S18.UGC END) As [DrGL],(CASE WHEN S9.GID>0 THEN (CASE WHEN ",
            "S9.GID=S19.GID THEN S19.UGC ELSE S18.UGC END) ELSE S19.UGC END) As [CrGL],(CASE WHEN LEN(ISNULL(SN.SNo,''))>0 THEN LEFT(ISNULL(SN.SNo,' '), LEN(ISNULL(SN.SNo,' '))-1) ELSE '' END) As ",
            "[Z_SerialNo] FROM TSTF INNER JOIN AMF ON TSTF.AcctID=AMF.ID INNER JOIN AMF H ON TSTF.Handler= H.ID LEFT JOIN CMF ON TSTF.CMFID=CMF.ID LEFT JOIN AMF AMF1 ON CMF.Sales= AMF1.ID LEFT JOIN CLD ",
            "ON TSTF.CLDID=CLD.ID LEFT JOIN SGM S1 ON TSTF.G207= S1.GID LEFT JOIN SGM S2 ON TSTF.G208= S2.GID LEFT JOIN SGM S3 ON TSTF.G250= S3.GID INNER JOIN TSTD ON TSTF.ID=TSTD.TSTFID LEFT JOIN SGM ",
            "S4 ON TSTD.UOM= S4.GID LEFT JOIN SGM S5 ON TSTD.G199= S5.GID LEFT JOIN SGM S6 ON TSTD.G201= S6.GID LEFT JOIN SGM S7 ON TSTD.G202= S7.GID LEFT JOIN SGM S8 ON TSTD.G206= S8.GID LEFT JOIN SGM ",
            "S9 ON TSTD.GLID= S9.GID LEFT JOIN SGM S31 ON AMF.G31= S31.GID LEFT JOIN SGM S35 ON AMF.G35= S35.GID LEFT JOIN SGM S9T ON S9.Val=S9T.GID LEFT JOIN PDS ON TSTD.StockID=PDS.ID LEFT JOIN SGM ",
            "S10 ON PDS.G230= S10.GID LEFT JOIN SGM S58 ON PDS.G58= S58.GID LEFT JOIN SGM S11 ON TSTD.G250= S11.GID LEFT JOIN SGM S12 ON CLD.PaymentMode= S12.GID INNER JOIN SGM S13 ON TSTF.G2= S13.GID ",
            "LEFT JOIN SGM S14 ON CLD.State= S14.GID LEFT JOIN SGM S14CT ON CLD.Country= S14CT.GID LEFT JOIN TSTF BT ON TSTD.BatchID= BT.ID LEFT JOIN SGM S16 ON CMF.G203= S16.GID LEFT JOIN SGM S17 ON ",
            "TSTF.PymtTerms= S17.GID LEFT JOIN SGM S20 ON CMF.G200= S20.GID LEFT JOIN SGM S23 ON TSTF.State= S23.GID LEFT JOIN SGM S24 ON TSTF.Country= S24.GID LEFT JOIN SGM OG1 ON TSTF.OGID= OG1.GID ",
            "LEFT JOIN SGM OG2 ON CMF.OGID= OG2.GID LEFT JOIN SGM OG3 ON CLD.OG= OG3.GID LEFT JOIN TSTF AB ON CLD.AB_TSTFID= AB.ID LEFT JOIN TSTF OTSTF ON TSTF.OldDocNo= OTSTF.ID LEFT JOIN AMF OAMF ON ",
            "OAMF.ID=OTSTF.AcctID LEFT JOIN SGM S25 ON S25.GID=OTSTF.State LEFT JOIN SGM S26 ON S26.GID=OTSTF.Country LEFT JOIN (SELECT TSTFID,SUM(CASE WHEN GstXID>0 THEN 0 ELSE OTax1 END) As ",
            "[Z_OTotalTax1],SUM(CASE WHEN GstXID>0 THEN 0 ELSE LTax1 END) As [Z_LTotalTax1],SUM(CASE WHEN GstXID>0 THEN 0 ELSE OTax2 END) As [Z_OTotalTax2],SUM(CASE WHEN GstXID>0 THEN 0 ELSE LTax2 END) ",
            "As [Z_LTotalTax2],SUM(CASE WHEN GstXID>0 THEN OTax1 ELSE 0 END) As [Z_OTotalTax1X],SUM(CASE WHEN GstXID>0 THEN LTax1 ELSE 0 END) As [Z_LTotalTax1X],SUM(CASE WHEN GstXID>0 THEN OTax2 ELSE 0 ",
            "END) As [Z_OTotalTax2X],SUM(CASE WHEN GstXID>0 THEN LTax2 ELSE 0 END) As [Z_LTotalTax2X] FROM TSTD GROUP BY TSTFID) TT ON TT.TSTFID=TSTF.ID LEFT JOIN (SELECT TSTFID,TSTD.T1G60 As ",
            "[TGID],(CASE WHEN CHARINDEX('L',S.SCC)>0 THEN TSTD.GLID ELSE NULL END) AS TGLID,SUM(CASE WHEN GstXID>0 THEN 0 ELSE OTax1 END) As [OTaxTAmt],SUM(CASE WHEN GstXID>0 THEN 0 ELSE LTax1 END) As ",
            "[LTaxTAmt],SUM(CASE WHEN GstXID>0 THEN OTax1 ELSE 0 END) As [OTaxTAmtX],SUM(CASE WHEN GstXID>0 THEN LTax1 ELSE 0 END) As [LTaxTAmtX] FROM TSTD LEFT JOIN SGM S ON TSTD.T1G60= S.GID GROUP BY ",
            "TSTFID,TSTD.T1G60,(CASE WHEN CHARINDEX('L',S.SCC)>0 THEN TSTD.GLID ELSE NULL END)) TG1 ON TG1.TSTFID=TSTF.ID AND TG1.TGID=TSTD.T1G60 AND ",
            "ISNULL(TSTD.GLID,0)=ISNULL(TG1.TGLID,ISNULL(TSTD.GLID,0)) LEFT JOIN (SELECT TSTFID,TSTD.T2G60 As [TGID],(CASE WHEN CHARINDEX('L',S.SCC)>0 THEN TSTD.GLID ELSE NULL END) AS TGLID,SUM(CASE WHEN ",
            "GstXID>0 THEN 0 ELSE OTax2 END) As [OTaxTAmt],SUM(CASE WHEN GstXID>0 THEN 0 ELSE LTax2 END) As [LTaxTAmt],SUM(CASE WHEN GstXID>0 THEN OTax2 ELSE 0 END) As [OTaxTAmtX],SUM(CASE WHEN GstXID>0 ",
            "THEN LTax2 ELSE 0 END) As [LTaxTAmtX] FROM TSTD LEFT JOIN SGM S ON TSTD.T2G60= S.GID GROUP BY TSTFID,TSTD.T2G60,(CASE WHEN CHARINDEX('L',S.SCC)>0 THEN TSTD.GLID ELSE NULL END)) TG2 ON ",
            "TG2.TSTFID=TSTF.ID AND TG2.TGID=TSTD.T2G60 AND ISNULL(TSTD.GLID,0)=ISNULL(TG2.TGLID,ISNULL(TSTD.GLID,0)) LEFT JOIN (SELECT TSTP.TSTFID,TSTP.G231,(CASE WHEN  (COALESCE(P.SCC,'') LIKE '%N%') ",
            "THEN 1 ELSE 0 END) As [TaxNegate],T.Abbrev As [TaxCode],T.Val As [TaxPct],T.SCC As [TaxSCC],(CASE WHEN CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.GID ELSE TDr.GID ",
            "END) ELSE NULL END) As [TaxGLID],(CASE WHEN CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.UGC ELSE TDr.UGC END) ELSE (CASE WHEN CHARINDEX('T',TDr.SCC)>0 THEN TDr.UGC ",
            "ELSE TCr.UGC END) END) As [TaxGLCode],(CASE WHEN CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.[Desc] ELSE TDr.[Desc] END) ELSE (CASE WHEN CHARINDEX('T',TDr.SCC)>0 ",
            "THEN TDr.[Desc] ELSE TCr.[Desc] END) END) As [TaxGLName],TSTP.OAmt As [OTaxTAmt],TSTP.LAmt As [LTaxTAmt] FROM TSTP LEFT JOIN SGM T ON TSTP.G231= T.GID INNER JOIN TSTF ON TSTP.TSTFID=TSTF.ID ",
            "LEFT JOIN SGM P ON TSTF.G2= P.GID LEFT JOIN SGM TDr ON TSTP.DrGL= TDr.GID LEFT JOIN SGM TCr ON TSTP.CrGL= TCr.GID WHERE TSTP.G231 IN(SELECT GID FROM SGM WHERE  SID=231 AND (COALESCE(SCC,'') ",
            "LIKE '%T%')) AND (CHARINDEX('T',TDr.SCC)>0 OR CHARINDEX('T',TCr.SCC)>0 OR CHARINDEX('L',T.SCC)>0)) T1 ON T1.TSTFID=TSTF.ID AND T1.G231=TSTD.T1G60 AND ",
            "ISNULL(TSTD.GLID,0)=ISNULL(T1.TaxGLID,ISNULL(TSTD.GLID,0)) LEFT JOIN (SELECT TSTP.TSTFID,TSTP.G231,(CASE WHEN  (COALESCE(P.SCC,'') LIKE '%N%') THEN 1 ELSE 0 END) As [TaxNegate],T.Abbrev As ",
            "[TaxCode],T.Val As [TaxPct],T.SCC As [TaxSCC],(CASE WHEN CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.GID ELSE TDr.GID END) ELSE NULL END) As [TaxGLID],(CASE WHEN ",
            "CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.UGC ELSE TDr.UGC END) ELSE (CASE WHEN CHARINDEX('T',TDr.SCC)>0 THEN TDr.UGC ELSE TCr.UGC END) END) As [TaxGLCode],(CASE ",
            "WHEN CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.[Desc] ELSE TDr.[Desc] END) ELSE (CASE WHEN CHARINDEX('T',TDr.SCC)>0 THEN TDr.[Desc] ELSE TCr.[Desc] END) END) As ",
            "[TaxGLName],TSTP.OAmt As [OTaxTAmt],TSTP.LAmt As [LTaxTAmt] FROM TSTP LEFT JOIN SGM T ON TSTP.G231= T.GID INNER JOIN TSTF ON TSTP.TSTFID=TSTF.ID LEFT JOIN SGM P ON TSTF.G2= P.GID LEFT JOIN ",
            "SGM TDr ON TSTP.DrGL= TDr.GID LEFT JOIN SGM TCr ON TSTP.CrGL= TCr.GID WHERE TSTP.G231 IN(SELECT GID FROM SGM WHERE  SID=231 AND (COALESCE(SCC,'') LIKE '%T%')) AND (CHARINDEX('T',TDr.SCC)>0 ",
            "OR CHARINDEX('T',TCr.SCC)>0 OR CHARINDEX('L',T.SCC)>0)) T2 ON T2.TSTFID=TSTF.ID AND T2.G231=TSTD.T2G60 AND ISNULL(TSTD.GLID,0)=ISNULL(T1.TaxGLID,ISNULL(TSTD.GLID,0)) LEFT JOIN SGM S21 ON ",
            "S21.GID=TSTD.T1G60 LEFT JOIN SGM S22 ON S22.GID=TSTD.T2G60 LEFT JOIN (SELECT PID,CID,0 AS IsDO FROM TSTF INNER JOIN TSTP ON TSTF.ID=TSTP.TSTFID INNER JOIN MRL ON TSTP.TSTFID=MRL.CID WHERE ",
            "TSTF.SS='P' AND RelID=2 AND G231 IN(SELECT GID FROM SGM WHERE  SID=231 AND (COALESCE(SCC,'') LIKE '%T%')) UNION ALL SELECT PID,CID,1 AS IsDO FROM TSTF INNER JOIN TSTP ON TSTF.ID=TSTP.TSTFID ",
            "INNER JOIN MRL ON TSTP.TSTFID=MRL.CID WHERE TSTF.SS='P' AND RelID=2 AND G231 IN(SELECT GID FROM SGM WHERE  SID=231 AND (COALESCE(SCC,'') LIKE '%T%'))) STK ON STK.PID=TSTF.ID AND ",
            "STK.CID=TSTD.BatchID INNER JOIN (SELECT TSTF.ID,GstDT,TrxDT,(CASE WHEN TSTF.G2 IN(83,84,88,89) THEN 1 ELSE 0 END)  AS IsDP,GstRef,0 as IsIM FROM TSTF WHERE ID IN(SELECT TSTFID FROM TSTP ",
            " WHERE G231 IN(SELECT GID FROM SGM WHERE  SID=231 AND (COALESCE(SCC,'') LIKE '%T%'))) AND G2<>49 ",
            ") TXDT ON TXDT.ID=TSTF.ID  LEFT JOIN SGM OG ON OG.GID=TSTF.OGID LEFT JOIN (SELECT DrGL,CrGL,TSTFID FROM TSTP WHERE G231=23101) P ON P.TSTFID=TSTF.ID LEFT JOIN SGM S18 ON S18.GID=P.DrGL ",
            "LEFT JOIN SGM S19 ON S19.GID=P.CrGL CROSS APPLY(SELECT TSTS.SNo +', ' FROM TSTS WHERE TSTS.TSTDID>0 AND TSTS.CSSID=0 AND TSTS.TSTDID=TSTD.ID FOR XML PATH('')) SN(SNo) LEFT JOIN (SELECT ",
            "DocNo,AccID,InstNo,OXAmt,LXAmt,GLID,PDDT,InputDT,ER FROM AOF WHERE TrxSeq=0) A ON A.DocNo=TSTF.ID AND A.AccID=TSTF.AcctID AND A.InstNo=TSTF.InstNo LEFT JOIN (SELECT DocNo,AccID,InstNo,SUM(OAmt) AS ",
            "OXAmt,SUM(LXAmt) AS LXAmt,MAX(CASE WHEN TrxSeq>0 THEN DocDT ELSE NULL END) AS LastARAP_Date FROM AOF WHERE DocDT<='31 Dec 2025' GROUP BY DocNo,AccID,InstNo) B ON B.DocNo=TSTF.ID AND ",
            "B.AccID=TSTF.AcctID AND B.InstNo=TSTF.InstNo LEFT JOIN vwAML SAL ON SAL.ID=CMF.AMLID LEFT JOIN SGM S15 ON A.GLID=S15.GID LEFT JOIN (SELECT INF.XDocID,SGM.[Desc] FROM INF INNER JOIN SGM ON ",
            " INF.G310=SGM.GID INNER JOIN (SELECT MAX(ID) As [ID],XDocID FROM INF WHERE INF.SrcTable='TSTF' AND INF.SS='S' GROUP BY XDocID) I ON I.ID=INF.ID) S ON S.XDocID=TSTF.ID LEFT JOIN (SELECT ",
            "S2.GID As [CID],(CASE WHEN LEN(ISNULL(R.Route,''))>0 THEN LEFT(ISNULL(R.Route,''), LEN(ISNULL(R.Route,''))-1) ELSE '' END) As [Route],(CASE WHEN LEN(ISNULL(V.RouteAbbrev,''))>0 THEN  ",
            "LEFT(ISNULL(V.RouteAbbrev,''),LEN(ISNULL(V.RouteAbbrev,''))-1) ELSE '' END) As [RouteAbbrev],S2.[Desc] As [Zone],S2.Abbrev As [ZoneAbbrev],S2.UGC As [ZoneUGC],S3.[Desc] As ",
            "[ZoneState],S3.Abbrev As [ZoneStateAbbrev] FROM SGM S2  LEFT JOIN (SELECT GID,[Desc],Abbrev FROM SGM WHERE SID=109) S3 ON S3.GID=S2.Val CROSS APPLY (SELECT S1.[Desc]+', ' FROM MRL INNER JOIN ",
            "SGM S1 ON S1.GID=MRL.PID WHERE MRL.RelID=271 AND MRL.CID=S2.GID FOR XML PATH('')) R(Route) CROSS APPLY (SELECT S1.[Abbrev]+', ' FROM MRL INNER JOIN SGM S1 ON S1.GID=MRL.PID WHERE MRL.RelID=",
            "271 AND MRL.CID=S2.GID FOR XML PATH('')) V(RouteAbbrev) WHERE S2.SID=270) Z ON Z.CID=TSTF.LUAID CROSS APPLY(SELECT AMF.Name +', ' FROM TSTT INNER JOIN AMF ON TSTT.AMFID=AMF.ID WHERE ",
            "TSTT.TSTFID=TSTF.ID FOR XML PATH('')) Tech(TechName) WHERE (((((TSTF.SS IN('A','P','C')) AND ISNULL(TSTD.SCC,'')='') AND ",
            " (S13.SCC LIKE '%P%' OR (S13.GID=80 AND  (COALESCE(S3.SCC,'') LIKE '%E%' AND COALESCE(S3.SCC,'') LIKE '%D%' AND COALESCE(S3.SCC,'') LIKE '%S%')))) AND S13.GID ",
            " NOT IN(73,78)) AND ISNULL(TSTF.GstRevG231,0)=0) AND ((TXDT.IsIM=0 AND ISNULL(TSTD.GstXID,0)=0) OR (TXDT.IsIM=1 AND TSTD.GstXID>0)) ",
            " ) T WHERE @TrxDT @LastSync DocType  = 'Invoice' "," ORDER BY InputDT, ID, DocDT,Doc_No "].join(' ');  

/*** customized queries **/

var sibplclient = ["SELECT @LIMIT ID, (case when OG.val=0 or OG.val=30 then replace(right(OG.abbrev,2),'ST','SIB') else substring(OG.[desc],1,3) end) AS OGCode,OG.[Desc] AS OGName,AccNo,Status,Name,AMF.Abbrev,CSince AS [C_Ment_Since],",
        "OPhone AS [Office_Phone], HPhone AS [House_Phone], Mobile AS [Mobile_Phone], Fax, Contact, (case when len(isnull(add1,''))=0 then 'No address' else Add1 end) as Add1, Add2, Add3, Zip AS [Post_Code],",
        "replace(LTRIM(RTRIM((case when patindex('%@%',Email)=0 THEN 'noemail@noemail.noemail' WHEN patindex('%,%',replace(Email,'/',','))>0 then substring(Email,1,patindex('%,%',replace(Email,'/',','))-1) when RTRIM(ISNULL(Email,''))='' THEN 'noemail@noemail.noemail' else Email end))),' ','.') as Email,",
        "(CASE WHEN CNT.[Desc] IS NULL THEN 'Malaysia' ELSE UPPER(SUBSTRING(CNT.[Desc],1,1))+LOWER(SUBSTRING(CNT.[Desc],2,100)) END) As [Country],(CASE WHEN NRIC='NA' THEN NULL ELSE NRIC END) AS [IC_Reg_ID], DOB AS [Birthdate], Gender,",
        "(SELECT [Desc] FROM SGM WHERE GID=State) As [State],(CASE WHEN AMF.G30=301 THEN 'Customer' WHEN AMF.G30=302 THEN 'Supplier' WHEN AMF.G30=303 THEN 'Introducer' WHEN AMF.G30=309 THEN 'Other Creditors' WHEN AMF.G30=310 THEN 'Insurer' ELSE 'General' END) As [Type],(SELECT [Desc] FROM SGM WHERE GID=G31) As [Class],",
        "(CASE WHEN G32.[Desc]='Others' THEN 'Miscellaneous / Others' ELSE G32.[Desc] END) As [Industry], (SELECT [Desc] FROM SGM WHERE GID=G33) As [Nature], (SELECT [Desc] FROM SGM WHERE GID=G35) As [Incorporation], ",
        "(SELECT Name FROM AMF As [A] WHERE A.ID=AMF.Handler) As [Sales],( SELECT Name FROM AMF As [A] WHERE A.ID=AMF.Asst) As [Asst_Sales],(SELECT AccNo FROM AMF As [A] ",
        "WHERE A.ID=AMF.RefAct) As [Referral], (SELECT AccNo FROM AMF As [A] WHERE A.ID=AMF.IntroducerID) As [Introducer],(SELECT AccNo FROM AMF As [A] ",
        "WHERE A.ID=AMF.HoldAccID) As [Holding],CurrCode AS [Currency_Code], Notes, Occupation AS [Position], NULL AS Salutation, AcctContact AS [Billing_Contact],(SELECT [Desc] ",
        "FROM SGM WHERE GID=G101) As [Credit_Terms],CrLimit As [Credit_Limit],TaxNo As [Tax_No], NULL As [InTax_Code],",
        "NULL As [OutTax_Code],GSTSBNo As [SelfBill_No],GstSBEff As [SelfBill_Effective],  GstSBExp As [SelfBill_Expiry],GstRegDT As [Gst_Reg_Date],",
        "BActNo1 As [BankAcc1],BActNo2 As [BankAcc2],(SELECT [Desc] FROM SGM WHERE GID=G36) As [NRIC_Type] ", "FROM AMF LEFT JOIN SGM OG ON AMF.OGID=OG.GID ",
        "LEFT JOIN SGM CT ON CT.GID = AMF.G30 LEFT JOIN SGM G32 ON G32.GID=AMF.G32 LEFT JOIN SGM CNT ON CNT.GID = AMF.Country WHERE @LastSync CT.[Desc] IN('Clients','Introducers','Supplier','Insurers (General)','Office') ORDER BY ID "].join('');
//'Clients', 'Supplier','Introducers','Office'

var sibpltrade = [ "SELECT @LIMIT ID, InputDT, TrxDT, OGCode,OGName, UpdateDT, Z_ID, Z_ODisc,",
            "(CASE WHEN DocType ='Expense Note' THEN 'Self-Billed Invoice' when DocType = 'Expense Debit' then 'Self-Billed Debit Note' when DocType = 'Expense Credit' THEN 'Self-Billed Credit Note' ELSE DocType end) as Doc_Type, UDNo as Doc_No, RefNo as RefNo, AccNo as AccNo, AcctName as Name, TrxDT as DocDT," ,
            "CCID as Currency, ex_rate, (CASE WHEN patindex('%Days%',PymtTerms)=0 THEN '0D' ELSE ISNULL(PymtTermsAbbrev,'0D') END) as Terms, Z_Desc as Trx_Desc, Z_Code as Item,  ",
            "Z_Qty as Qty, Z_OPrice as Price, Z_OAmt as Amount, (CASE WHEN Z_Tax1 IN('NT','NR','PNT','OS','OP','ZP','ZRL','ZRE') THEN '2220904' WHEN Z_Tax1 IN('ST','PST','ST8','PST8') THEN '2220903' WHEN ISNULL(Z_OAmt,0)=0 THEN '2220904' ELSE Z_Tax1 END) as Tax1, Z_Tax1Pct as Tax1_Rate, Z_OTax1 as Tax1_Amount, ",
            "(CASE WHEN LEN(ISNULL(Z_UOM,''))=0 THEN 'un' ELSE REPLACE(Z_UOM,'unit','un') END) AS Z_UOM, Status, OldUDNo as XDoc_No FROM ( SELECT (case when OG.val=0 or OG.val=30 then replace(right(OG.abbrev,2),'ST','SIB') else substring(OG.[desc],1,3) end) as OGCode, OG.[Desc] as OGName, TSTF.UpdateDT, TSTF.OGID,TSTF.ID,TSTF.CMFID,TSTF.DONo,TSTF.CustRef, TSTF.RefNo,TSTF.Header,TSTF.Remarks,",
            "TSTF.DONotes,TSTF.PhO,TSTF.PhH,TSTF.PhM,TSTF.Fax,TSTF.Email,TSTF.Contact,TSTF.Info,TSTF.Info2,TSTF.Rating,TSTF.DelDT,TSTF.StartDT,TSTF.EndDT,TSTF.Period,TSTF.Narration,",
            "ISNULL(A.InputDT,TSTF.InputDT) AS InputDT, ISNULL(A.ER,1) AS ex_rate,TSTF.EnterBy,TSTF.FeedBack,TSTF.DelNo,TSTF.IsBadDebt,TSTF.GstDT,TSTF.GSTIncl,TSTF.GstSimp,TSTF.GstSBNo,TXDT.TrxDT,(CASE WHEN TSTF.G2=49 THEN 1 ELSE 0 END) As [GstGift],",
            "TSTF.G2 As [DocG2],TSTF.Duration/60 As [Duration],OTSTF.UDNo As [OldUDNo],CMF.UDNo+'/'+RIGHT('00'+CAST((SELECT COUNT(*) FROM CLD D WHERE D.CMFID=CMF.ID AND D.ID<=CLD.ID) AS VARCHAR),2) ",
            "As [SetUDNo],OTSTF.GstDT As [OldGstDT],OTSTF.TrxDT As [OldTrxDT],OTSTF.OAmt As [OldOAmt],OTSTF.CCID As [OldCCID],CMF.EffDT,CMF.ExpDT,CMF.RenNo,CMF.CustName As [Customer],CMF.UDNo As ",
            "[Contract_No],CMF.Remarks As [Title],AMF1.Name As [SalesName],AMF1.Abbrev As [SalesA],S16.[Desc] As [OrderStatus],S20.[Desc] As [OrderType],S20.Abbrev As [OrderTypeAbbrev],S20.UGC As ",
            "[OrderTypeUGC],CLD.RetentionP,CLD.CommP,CLD.OComm,CLD.LComm,CLD.OAmt As [OrderSetAmt],CLD.Title As [OrderSetTitle],CLD.Billing As [PaymentFreq],CLD.Freq,S12.[Desc] As ",
            "[PaymentMode],SAL.G216Desc As [Salutation],SAL.G205Desc As [PremiseType],REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE('[Add1]'+' '+'[Add2]'+' '+'[Add3]'+' ",
            "'+'[ZIP] [State]'+' '+'[Country].','[Add1]',ISNULL(CLD.Add1,'')),'[Add2]',ISNULL(CLD.Add2,'')),'[Add3]',ISNULL(CLD.Add3,'')),'[State]',ISNULL(S14.[Desc],'')),'[Zip]',ISNULL(CLD.Zip,'')), ",
            "'[Country]',ISNULL(S14CT.[Desc],'')),''+' '+''+' '+''+' '+'',''+' '+''),''+' '+''+' '+'',''+' '+''),''+' '+'','Â '+' '+'') As [LocAddress],dbo.GetDeliverables(CLD.ID) As ",
            " [Deliverables],AB.UDNo As [AutoBillTempNo],CASE TSTF.SS WHEN 'P' THEN (CASE WHEN TSTF.TS='C' THEN 'Cancelled' ELSE 'Posted' END) WHEN 'C' THEN 'Cancelled' WHEN 'T' THEN 'Template' ELSE ",
            "(CASE WHEN TSTF.TS='D' THEN 'Draft' ELSE 'Active' END) END As [Status],CAST(0 AS MONEY)OTInMinute,CAST(0 AS MONEY)OTInMinuteHoliday,DATENAME(dw,TSTF.StartDT) As [WeekDayName],(CASE WHEN ",
            "(SELECT COUNT(*) FROM HOL WHERE HOL.Title NOT IN('Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday') AND TSTF.StartDT>=HOL.StartDT AND ",
            "HOL.EndDT>=dbo.dateserial(DAY(TSTF.StartDT),MONTH(TSTF.StartDT),YEAR(TSTF.StartDT)))>0 THEN 1 ELSE 0 END) As [IsHoliday],S.[Desc] As [Status2],S1.[Desc] As [ServiceNature],S2.[Desc] As ",
            "[WorkType],S3.[Desc] As [StockNoteType],A.GLID,A.PDDT As [DueDT],S15.[UGC] As [GLCode],S15.[Desc] As [GLName],(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN 1 ELSE 0 END) AS IsNegate, ",
            "S13.[Desc] As [DocType],(CASE WHEN S13.SCC LIKE '%S%' THEN 1 WHEN S3.SCC LIKE '%S%' THEN 1 ELSE 0 END) As [ForSales],(CASE WHEN S13.SCC LIKE '%O%' THEN 1 WHEN S3.SCC LIKE '%O%' THEN 1 ",
            "ELSE 0 END) As [ForPurchase],S17.[Desc] As [PymtTerms],ISNULL(S17.UGC,S17.Abbrev) As [PymtTermsAbbrev],(CASE COALESCE(TSTD.SCC,'') WHEN '' THEN 'Bill Items' WHEN 'S' THEN 'Servicing' WHEN 'T' THEN ",
            "'Tracking' WHEN 'P' THEN 'Payment' ELSE 'Unknown' END) As [Z_TypeDesc],COALESCE(TSTD.SCC,'A') As [Z_Type],TSTD.ID As [Z_ID],TSTD.[Desc] As [Z_Desc],TSTD.Qty As [Z_Qty],TSTD.LastQty As ",
            "[Z_LastQty],TSTD.Qty-ISNULL(TSTD.LastQty,'') As [Z_UsageQty],TSTD.StockID As [Z_StockID],TSTD.RefNo As [Z_RefNo],TSTD.Rates As [Z_Rates],TSTD.ETA As [Z_ETA],TSTD.Tag As ",
            "[Z_Tag],TSTD.BatchNo As [Z_BatchNo],BT.TrxDT As [Z_BatchDT],BT.GstDT As [Z_GstDT],BT.OAmt As [Z_BatchOAmt],BT.LAmt As [Z_BatchLAmt],TSTD.StartDT As [Z_StartDT],TSTD.EndDT As ",
            "[Z_EndDT],TSTD.Duration/60 As [Z_Duration],TSTD.CommPct As [Z_CommPct],TSTD.DiscPct As [Z_DiscPct],TSTD.Tax1Pct As [Z_Tax1Pct],TSTD.Tax2Pct As [Z_Tax2Pct],S4.[UGC] As [Z_UOM],S5.[Desc] As ",
            "[Z_Status],S6.[Desc] As [Z_Action],S7.[Desc] As [Z_Area],S8.[Desc] As [Z_Target],S9.[UGC] As [Z_GLCode],S9.[Desc] As [Z_GLName],S9T.[Desc] As [Z_GLType],(CASE WHEN S9T.SCC LIKE '%A%' THEN ",
            " 1 ELSE 0 END) As [Z_IsCapital],PDS.Name As [Z_Name],PDS.Code As [Z_Code],PDS.BarCode As [Z_BarCode],S58.UGC As [StockTariffCode],S58.[Desc] As [StockTariffDesc],S10.[Desc] As ",
            "[Z_StockType],S10.SCC As [Z_StockSCC],S11.[Desc] As [Z_StockNoteType],Z.Route, Z.Zone, ISNULL(Z.Route + ' - ','') + ISNULL(Z.Zone,'') AS RouteZone, Z.RouteAbbrev, Z.ZoneUGC, Z.ZoneAbbrev,",
            "Z.ZoneState, Z.ZoneStateAbbrev,OG1.[Desc] As [OG_Name],OG2.[Desc] As [OG_Name_Order],OG3.[Desc] As [OG_Name_OrderSet],(CASE WHEN LEN(ISNULL(Tech.TechName,''))>0 THEN ",
            "LEFT(ISNULL(Tech.TechName,' '), LEN(ISNULL(Tech.TechName,' '))-1) ELSE '' END) As [TechName],B.LastARAP_Date,S31.[Desc] As [Account_Type],S35.[Desc] As [Acct_Inc],S35.UGC As ",
            "[Acct_Inc_UGC],(CASE WHEN AMF.Name LIKE '%takaful%' THEN 1 ELSE 0 END) As [Takaful],H.Name as HandlerName,TSTF.PostHandler, ",
            "(CASE WHEN TXDT.IsIM=1 THEN OTSTF.UDNo+'(K1)' ELSE (CASE WHEN ISNULL(STK.IsDO,0)=1 THEN TSTD.BatchNo ELSE (CASE WHEN LEN(TSTF.DONo)>0 AND TSTF.G2=80 THEN TSTF.DONo ELSE TSTF.UDNo END) END) ",
            "END) AS UDNo,(CASE WHEN TXDT.IsIM=1 THEN OTSTF.AcctID ELSE TSTF.AcctID END) AS AcctID,(CASE WHEN TXDT.IsIM=1 THEN OTSTF.AcctName ELSE TSTF.AcctName END) AS AcctName,(CASE WHEN TXDT.IsIM=1 ",
            "THEN OTSTF.CCID ELSE TSTF.CCID END) AS CCID,TXDT.GstRef, (CASE WHEN TXDT.IsIM=1 THEN OAMF.AccNo ELSE AMF.AccNo END) AS AccNo,(CASE WHEN TXDT.IsIM=1 THEN OAMF.NRIC ELSE AMF.NRIC END) AS ",
            "NRIC,(CASE WHEN TXDT.IsIM=1 THEN OAMF.OldNRIC ELSE AMF.OldNRIC END) AS OldNRIC,(CASE WHEN TXDT.IsIM=1 THEN OAMF.TaxNo ELSE AMF.TaxNo END) AS TaxNo,(CASE WHEN TXDT.IsIM=1 THEN OAMF.Email ",
            "ELSE AMF.Email END) AS MailTo,(CASE WHEN TXDT.IsIM=1 THEN S23.[Desc] ELSE S25.[Desc] END) AS ContactState,(CASE WHEN TXDT.IsIM=1 THEN S24.[Desc] ELSE S26.[Desc] END) AS ",
            "ContactCountry,(CASE WHEN TXDT.IsIM=1 THEN (CASE WHEN OAMF.G31=311 THEN OAMF.NRIC ELSE '' END) ELSE (CASE WHEN AMF.G31=311 THEN AMF.NRIC ELSE '' END) END) AS BusReg, ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTF.OAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS OAmt,(CASE WHEN ",
            "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTF.LAmt As [LAmt], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTF.OGross/(CASE WHEN TXDT.IsIM=1 ",
            "AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS OGross,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTF.LGross As [LGross], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTF.OAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS OAmtN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTF.LAmt As [LAmtN], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTF.OGross/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS OGrossN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTF.LGross As [LGrossN], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*A.OXAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS OS_OAmt,(CASE WHEN ",
            "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*A.LXAmt As [OS_LAmt], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 ",
            "THEN -1 ELSE 1 END)*A.OXAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS OS_OAmtN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN ",
            "PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*A.LXAmt As [OS_LAmtN], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*B.OXAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 ",
            "THEN OTSTF.ER ELSE 1 END),2) AS OSAsAt_OAmt,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*B.LXAmt As [OSAsAt_LAmt], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*B.OXAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS OSAsAt_OAmtN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*B.LXAmt As ",
            "[OSAsAt_LAmtN], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.OAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OAmt,(CASE WHEN ",
            "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LAmt As [Z_LAmt], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.OPrice/(CASE WHEN TXDT.IsIM=1 ",
            "AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OPrice,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LPrice As [Z_LPrice],",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS Z_OAmtN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LAmt As [Z_LAmtN],",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OPrice/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS Z_OPriceN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LPrice As [Z_LPriceN], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.ODisc/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_ODisc,(CASE WHEN ",
            "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LDisc As [Z_LDisc], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.OComm/(CASE WHEN TXDT.IsIM=1 ",
            "AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OComm,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LComm As [Z_LComm], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.ODisc/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS Z_ODiscN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LDisc As [Z_LDiscN], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OComm/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS Z_OCommN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LComm As [Z_LCommN], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.OTax1/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax1,(CASE WHEN ",
            "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LTax1 As [Z_LTax1], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.OTax2/(CASE WHEN TXDT.IsIM=1 ",
            "AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax2,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LTax2 As [Z_LTax2], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR ",
            "TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OTax1/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax1N,(CASE ",
            "WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LTax1 As [Z_LTax1N], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR ",
            "TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OTax2/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax2N,(CASE ",
            "WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LTax2 As [Z_LTax2N], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR ",
            "TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OTax1/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS ",
            "Z_OTax1N_GST03,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LTax1 As [Z_LTax1N_GST03], ",
            "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OTax2/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS Z_OTax2N_GST03,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LTax2 As ",
            "[Z_LTax2N_GST03], S21.Abbrev As [Z_Tax1],S21.[Desc] As [Z_Tax1Desc],(CASE WHEN S21.SCC LIKE '%I%' THEN 1 ELSE 0 END) As [Z_Tax1_InputTax],(CASE WHEN S21.SCC LIKE '%O%' THEN 1 ELSE 0 END) ",
            "As [Z_Tax1_OutputTax],(CASE WHEN S21.SCC LIKE '%R%' THEN 1 ELSE 0 END) As [Z_Tax1_IRR_Supply],(CASE WHEN S21.SCC LIKE '%E%' THEN 1 ELSE 0 END) As [Z_Tax1_IRR_Exempt],(CASE WHEN S21.SCC ",
            "LIKE '%U%' THEN 1 ELSE 0 END) As [Z_Tax1_IRR_Residual],T1.TaxGLCode As [Z_Tax1Code],T1.TaxGLName As [Z_Tax1Name], S22.Abbrev As [Z_Tax2],S22.[Desc] As [Z_Tax2Desc],(CASE WHEN S22.SCC LIKE ",
            "'%I%' THEN 1 ELSE 0 END) As [Z_Tax2_InputTax],(CASE WHEN S22.SCC LIKE '%O%' THEN 1 ELSE 0 END) As [Z_Tax2_OutputTax],(CASE WHEN S22.SCC LIKE '%R%' THEN 1 ELSE 0 END) As [Z_Tax2_IRR_Supply],",
            "(CASE WHEN S22.SCC LIKE '%E%' THEN 1 ELSE 0 END) As [Z_Tax2_IRR_Exempt], (CASE WHEN S22.SCC LIKE '%U%' THEN 1 ELSE 0 END) As [Z_Tax2_IRR_Residual],T2.TaxGLCode As [Z_Tax2Code],T2.TaxGLName ",
            "As [Z_Tax2Name], CAST(1 AS FLOAT) As [Z_IRR], ROUND((CASE WHEN TXDT.IsIM=1 THEN TT.Z_OTotalTax1X ELSE TT.Z_OTotalTax1 END)/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 ",
            " END),2) AS Z_OTotalTax1,(CASE WHEN TXDT.IsIM=1 THEN TT.Z_LTotalTax1X ELSE TT.Z_LTotalTax1 END) AS Z_LTotalTax1, ROUND((CASE WHEN TXDT.IsIM=1 THEN TT.Z_OTotalTax2X ELSE TT.Z_OTotalTax2 ",
            "END)/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTotalTax2,(CASE WHEN TXDT.IsIM=1 THEN TT.Z_LTotalTax2X ELSE TT.Z_LTotalTax2 END) AS Z_LTotalTax2, ROUND((CASE ",
            "WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(CASE WHEN TXDT.IsIM=1 THEN TT.Z_OTotalTax1X ELSE TT.Z_OTotalTax1 ",
            "END)/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTotalTax1N,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 ",
            "THEN -1 ELSE 1 END)*(CASE WHEN TXDT.IsIM=1 THEN TT.Z_LTotalTax1X ELSE TT.Z_LTotalTax1 END) As [Z_LTotalTax1N], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 ",
            " END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(CASE WHEN TXDT.IsIM=1 THEN TT.Z_OTotalTax2X ELSE TT.Z_OTotalTax2 END)/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) ",
            "AS Z_OTotalTax2N,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(CASE WHEN TXDT.IsIM=1 THEN TT.Z_LTotalTax2X ",
            "ELSE TT.Z_LTotalTax2 END) As [Z_LTotalTax2N], ROUND((T1.OTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG1.OTaxTAmt ELSE TG1.OTaxTAmtX END),0))/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
            "OTSTF.ER ELSE 1 END),2) AS Z_OTax1Sum,T1.LTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG1.LTaxTAmt ELSE TG1.LTaxTAmtX END),0) As [Z_LTax1Sum], ROUND((T2.OTaxTAmt-ISNULL((CASE WHEN ",
            "TXDT.IsIM=1 THEN TG2.OTaxTAmt ELSE TG2.OTaxTAmtX END),0))/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax2Sum,T2.LTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN ",
            "TG2.LTaxTAmt ELSE TG2.LTaxTAmtX END),0) As [Z_LTax2Sum], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 ",
            "END)*(T1.OTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG1.OTaxTAmt ELSE TG1.OTaxTAmtX END),0))/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax1SumN,(CASE WHEN ",
            "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(T1.LTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG1.LTaxTAmt ELSE ",
            "TG1.LTaxTAmtX END),0)) As [Z_LTax1SumN], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(T2.OTaxTAmt - ",
            "ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG2.OTaxTAmt ELSE TG2.OTaxTAmtX END),0))/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax2SumN,(CASE WHEN ",
            "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(T2.LTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG2.LTaxTAmt ELSE ",
            "TG2.LTaxTAmtX END),0)) As [Z_LTax2SumN] ,(CASE WHEN S9.GID>0 THEN (CASE WHEN S9.GID=S18.GID THEN S18.UGC ELSE S19.UGC END) ELSE S18.UGC END) As [DrGL],(CASE WHEN S9.GID>0 THEN (CASE WHEN ",
            "S9.GID=S19.GID THEN S19.UGC ELSE S18.UGC END) ELSE S19.UGC END) As [CrGL],(CASE WHEN LEN(ISNULL(SN.SNo,''))>0 THEN LEFT(ISNULL(SN.SNo,' '), LEN(ISNULL(SN.SNo,' '))-1) ELSE '' END) As ",
            "[Z_SerialNo] FROM TSTF INNER JOIN AMF ON TSTF.AcctID=AMF.ID INNER JOIN AMF H ON TSTF.Handler= H.ID LEFT JOIN CMF ON TSTF.CMFID=CMF.ID LEFT JOIN AMF AMF1 ON CMF.Sales= AMF1.ID LEFT JOIN CLD ",
            "ON TSTF.CLDID=CLD.ID LEFT JOIN SGM S1 ON TSTF.G207= S1.GID LEFT JOIN SGM S2 ON TSTF.G208= S2.GID LEFT JOIN SGM S3 ON TSTF.G250= S3.GID INNER JOIN TSTD ON TSTF.ID=TSTD.TSTFID LEFT JOIN SGM ",
            "S4 ON TSTD.UOM= S4.GID LEFT JOIN SGM S5 ON TSTD.G199= S5.GID LEFT JOIN SGM S6 ON TSTD.G201= S6.GID LEFT JOIN SGM S7 ON TSTD.G202= S7.GID LEFT JOIN SGM S8 ON TSTD.G206= S8.GID LEFT JOIN SGM ",
            "S9 ON TSTD.GLID= S9.GID LEFT JOIN SGM S31 ON AMF.G31= S31.GID LEFT JOIN SGM S35 ON AMF.G35= S35.GID LEFT JOIN SGM S9T ON S9.Val=S9T.GID LEFT JOIN PDS ON TSTD.StockID=PDS.ID LEFT JOIN SGM ",
            "S10 ON PDS.G230= S10.GID LEFT JOIN SGM S58 ON PDS.G58= S58.GID LEFT JOIN SGM S11 ON TSTD.G250= S11.GID LEFT JOIN SGM S12 ON CLD.PaymentMode= S12.GID INNER JOIN SGM S13 ON TSTF.G2= S13.GID ",
            "LEFT JOIN SGM S14 ON CLD.State= S14.GID LEFT JOIN SGM S14CT ON CLD.Country= S14CT.GID LEFT JOIN TSTF BT ON TSTD.BatchID= BT.ID LEFT JOIN SGM S16 ON CMF.G203= S16.GID LEFT JOIN SGM S17 ON ",
            "TSTF.PymtTerms= S17.GID LEFT JOIN SGM S20 ON CMF.G200= S20.GID LEFT JOIN SGM S23 ON TSTF.State= S23.GID LEFT JOIN SGM S24 ON TSTF.Country= S24.GID LEFT JOIN SGM OG1 ON TSTF.OGID= OG1.GID ",
            "LEFT JOIN SGM OG2 ON CMF.OGID= OG2.GID LEFT JOIN SGM OG3 ON CLD.OG= OG3.GID LEFT JOIN TSTF AB ON CLD.AB_TSTFID= AB.ID LEFT JOIN TSTF OTSTF ON TSTF.OldDocNo= OTSTF.ID LEFT JOIN AMF OAMF ON ",
            "OAMF.ID=OTSTF.AcctID LEFT JOIN SGM S25 ON S25.GID=OTSTF.State LEFT JOIN SGM S26 ON S26.GID=OTSTF.Country LEFT JOIN (SELECT TSTFID,SUM(CASE WHEN GstXID>0 THEN 0 ELSE OTax1 END) As ",
            "[Z_OTotalTax1],SUM(CASE WHEN GstXID>0 THEN 0 ELSE LTax1 END) As [Z_LTotalTax1],SUM(CASE WHEN GstXID>0 THEN 0 ELSE OTax2 END) As [Z_OTotalTax2],SUM(CASE WHEN GstXID>0 THEN 0 ELSE LTax2 END) ",
            "As [Z_LTotalTax2],SUM(CASE WHEN GstXID>0 THEN OTax1 ELSE 0 END) As [Z_OTotalTax1X],SUM(CASE WHEN GstXID>0 THEN LTax1 ELSE 0 END) As [Z_LTotalTax1X],SUM(CASE WHEN GstXID>0 THEN OTax2 ELSE 0 ",
            "END) As [Z_OTotalTax2X],SUM(CASE WHEN GstXID>0 THEN LTax2 ELSE 0 END) As [Z_LTotalTax2X] FROM TSTD GROUP BY TSTFID) TT ON TT.TSTFID=TSTF.ID LEFT JOIN (SELECT TSTFID,TSTD.T1G60 As ",
            "[TGID],(CASE WHEN CHARINDEX('L',S.SCC)>0 THEN TSTD.GLID ELSE NULL END) AS TGLID,SUM(CASE WHEN GstXID>0 THEN 0 ELSE OTax1 END) As [OTaxTAmt],SUM(CASE WHEN GstXID>0 THEN 0 ELSE LTax1 END) As ",
            "[LTaxTAmt],SUM(CASE WHEN GstXID>0 THEN OTax1 ELSE 0 END) As [OTaxTAmtX],SUM(CASE WHEN GstXID>0 THEN LTax1 ELSE 0 END) As [LTaxTAmtX] FROM TSTD LEFT JOIN SGM S ON TSTD.T1G60= S.GID GROUP BY ",
            "TSTFID,TSTD.T1G60,(CASE WHEN CHARINDEX('L',S.SCC)>0 THEN TSTD.GLID ELSE NULL END)) TG1 ON TG1.TSTFID=TSTF.ID AND TG1.TGID=TSTD.T1G60 AND ",
            "ISNULL(TSTD.GLID,0)=ISNULL(TG1.TGLID,ISNULL(TSTD.GLID,0)) LEFT JOIN (SELECT TSTFID,TSTD.T2G60 As [TGID],(CASE WHEN CHARINDEX('L',S.SCC)>0 THEN TSTD.GLID ELSE NULL END) AS TGLID,SUM(CASE WHEN ",
            "GstXID>0 THEN 0 ELSE OTax2 END) As [OTaxTAmt],SUM(CASE WHEN GstXID>0 THEN 0 ELSE LTax2 END) As [LTaxTAmt],SUM(CASE WHEN GstXID>0 THEN OTax2 ELSE 0 END) As [OTaxTAmtX],SUM(CASE WHEN GstXID>0 ",
            "THEN LTax2 ELSE 0 END) As [LTaxTAmtX] FROM TSTD LEFT JOIN SGM S ON TSTD.T2G60= S.GID GROUP BY TSTFID,TSTD.T2G60,(CASE WHEN CHARINDEX('L',S.SCC)>0 THEN TSTD.GLID ELSE NULL END)) TG2 ON ",
            "TG2.TSTFID=TSTF.ID AND TG2.TGID=TSTD.T2G60 AND ISNULL(TSTD.GLID,0)=ISNULL(TG2.TGLID,ISNULL(TSTD.GLID,0)) LEFT JOIN (SELECT TSTP.TSTFID,TSTP.G231,(CASE WHEN  (COALESCE(P.SCC,'') LIKE '%N%') ",
            "THEN 1 ELSE 0 END) As [TaxNegate],T.Abbrev As [TaxCode],T.Val As [TaxPct],T.SCC As [TaxSCC],(CASE WHEN CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.GID ELSE TDr.GID ",
            "END) ELSE NULL END) As [TaxGLID],(CASE WHEN CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.UGC ELSE TDr.UGC END) ELSE (CASE WHEN CHARINDEX('T',TDr.SCC)>0 THEN TDr.UGC ",
            "ELSE TCr.UGC END) END) As [TaxGLCode],(CASE WHEN CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.[Desc] ELSE TDr.[Desc] END) ELSE (CASE WHEN CHARINDEX('T',TDr.SCC)>0 ",
            "THEN TDr.[Desc] ELSE TCr.[Desc] END) END) As [TaxGLName],TSTP.OAmt As [OTaxTAmt],TSTP.LAmt As [LTaxTAmt] FROM TSTP LEFT JOIN SGM T ON TSTP.G231= T.GID INNER JOIN TSTF ON TSTP.TSTFID=TSTF.ID ",
            "LEFT JOIN SGM P ON TSTF.G2= P.GID LEFT JOIN SGM TDr ON TSTP.DrGL= TDr.GID LEFT JOIN SGM TCr ON TSTP.CrGL= TCr.GID WHERE TSTP.G231 IN(SELECT GID FROM SGM WHERE  SID=231 AND (COALESCE(SCC,'') ",
            "LIKE '%T%')) AND (CHARINDEX('T',TDr.SCC)>0 OR CHARINDEX('T',TCr.SCC)>0 OR CHARINDEX('L',T.SCC)>0)) T1 ON T1.TSTFID=TSTF.ID AND T1.G231=TSTD.T1G60 AND ",
            "ISNULL(TSTD.GLID,0)=ISNULL(T1.TaxGLID,ISNULL(TSTD.GLID,0)) LEFT JOIN (SELECT TSTP.TSTFID,TSTP.G231,(CASE WHEN  (COALESCE(P.SCC,'') LIKE '%N%') THEN 1 ELSE 0 END) As [TaxNegate],T.Abbrev As ",
            "[TaxCode],T.Val As [TaxPct],T.SCC As [TaxSCC],(CASE WHEN CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.GID ELSE TDr.GID END) ELSE NULL END) As [TaxGLID],(CASE WHEN ",
            "CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.UGC ELSE TDr.UGC END) ELSE (CASE WHEN CHARINDEX('T',TDr.SCC)>0 THEN TDr.UGC ELSE TCr.UGC END) END) As [TaxGLCode],(CASE ",
            "WHEN CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.[Desc] ELSE TDr.[Desc] END) ELSE (CASE WHEN CHARINDEX('T',TDr.SCC)>0 THEN TDr.[Desc] ELSE TCr.[Desc] END) END) As ",
            "[TaxGLName],TSTP.OAmt As [OTaxTAmt],TSTP.LAmt As [LTaxTAmt] FROM TSTP LEFT JOIN SGM T ON TSTP.G231= T.GID INNER JOIN TSTF ON TSTP.TSTFID=TSTF.ID LEFT JOIN SGM P ON TSTF.G2= P.GID LEFT JOIN ",
            "SGM TDr ON TSTP.DrGL= TDr.GID LEFT JOIN SGM TCr ON TSTP.CrGL= TCr.GID WHERE TSTP.G231 IN(SELECT GID FROM SGM WHERE  SID=231 AND (COALESCE(SCC,'') LIKE '%T%')) AND (CHARINDEX('T',TDr.SCC)>0 ",
            "OR CHARINDEX('T',TCr.SCC)>0 OR CHARINDEX('L',T.SCC)>0)) T2 ON T2.TSTFID=TSTF.ID AND T2.G231=TSTD.T2G60 AND ISNULL(TSTD.GLID,0)=ISNULL(T1.TaxGLID,ISNULL(TSTD.GLID,0)) LEFT JOIN SGM S21 ON ",
            "S21.GID=TSTD.T1G60 LEFT JOIN SGM S22 ON S22.GID=TSTD.T2G60 LEFT JOIN (SELECT PID,CID,0 AS IsDO FROM TSTF INNER JOIN TSTP ON TSTF.ID=TSTP.TSTFID INNER JOIN MRL ON TSTP.TSTFID=MRL.CID WHERE ",
            "TSTF.SS='P' AND RelID=2 AND G231 IN(SELECT GID FROM SGM WHERE  SID=231 AND (COALESCE(SCC,'') LIKE '%T%')) UNION ALL SELECT PID,CID,1 AS IsDO FROM TSTF INNER JOIN TSTP ON TSTF.ID=TSTP.TSTFID ",
            "INNER JOIN MRL ON TSTP.TSTFID=MRL.CID WHERE TSTF.SS='P' AND RelID=2 AND G231 IN(SELECT GID FROM SGM WHERE  SID=231 AND (COALESCE(SCC,'') LIKE '%T%'))) STK ON STK.PID=TSTF.ID AND ",
            "STK.CID=TSTD.BatchID INNER JOIN (SELECT TSTF.ID,GstDT,TrxDT,(CASE WHEN TSTF.G2 IN(83,84,88,89) THEN 1 ELSE 0 END)  AS IsDP,GstRef,0 as IsIM FROM TSTF WHERE ID IN(SELECT TSTFID FROM TSTP ",
            " WHERE G231 IN(SELECT GID FROM SGM WHERE  SID=231 AND (COALESCE(SCC,'') LIKE '%T%'))) AND G2<>49 ",
            ") TXDT ON TXDT.ID=TSTF.ID  LEFT JOIN SGM OG ON OG.GID=TSTF.OGID LEFT JOIN (SELECT DrGL,CrGL,TSTFID FROM TSTP WHERE G231=23101) P ON P.TSTFID=TSTF.ID LEFT JOIN SGM S18 ON S18.GID=P.DrGL ",
            "LEFT JOIN SGM S19 ON S19.GID=P.CrGL CROSS APPLY(SELECT TSTS.SNo +', ' FROM TSTS WHERE TSTS.TSTDID>0 AND TSTS.CSSID=0 AND TSTS.TSTDID=TSTD.ID FOR XML PATH('')) SN(SNo) LEFT JOIN (SELECT ",
            "DocNo,AccID,InstNo,OXAmt,LXAmt,GLID,PDDT,InputDT,ER FROM AOF WHERE TrxSeq=0) A ON A.DocNo=TSTF.ID AND A.AccID=TSTF.AcctID AND A.InstNo=TSTF.InstNo LEFT JOIN (SELECT DocNo,AccID,InstNo,SUM(OAmt) AS ",
            "OXAmt,SUM(LXAmt) AS LXAmt,MAX(CASE WHEN TrxSeq>0 THEN DocDT ELSE NULL END) AS LastARAP_Date FROM AOF WHERE DocDT<='31 Dec 2025' GROUP BY DocNo,AccID,InstNo) B ON B.DocNo=TSTF.ID AND ",
            "B.AccID=TSTF.AcctID AND B.InstNo=TSTF.InstNo LEFT JOIN vwAML SAL ON SAL.ID=CMF.AMLID LEFT JOIN SGM S15 ON A.GLID=S15.GID LEFT JOIN (SELECT INF.XDocID,SGM.[Desc] FROM INF INNER JOIN SGM ON ",
            " INF.G310=SGM.GID INNER JOIN (SELECT MAX(ID) As [ID],XDocID FROM INF WHERE INF.SrcTable='TSTF' AND INF.SS='S' GROUP BY XDocID) I ON I.ID=INF.ID) S ON S.XDocID=TSTF.ID LEFT JOIN (SELECT ",
            "S2.GID As [CID],(CASE WHEN LEN(ISNULL(R.Route,''))>0 THEN LEFT(ISNULL(R.Route,''), LEN(ISNULL(R.Route,''))-1) ELSE '' END) As [Route],(CASE WHEN LEN(ISNULL(V.RouteAbbrev,''))>0 THEN  ",
            "LEFT(ISNULL(V.RouteAbbrev,''),LEN(ISNULL(V.RouteAbbrev,''))-1) ELSE '' END) As [RouteAbbrev],S2.[Desc] As [Zone],S2.Abbrev As [ZoneAbbrev],S2.UGC As [ZoneUGC],S3.[Desc] As ",
            "[ZoneState],S3.Abbrev As [ZoneStateAbbrev] FROM SGM S2  LEFT JOIN (SELECT GID,[Desc],Abbrev FROM SGM WHERE SID=109) S3 ON S3.GID=S2.Val CROSS APPLY (SELECT S1.[Desc]+', ' FROM MRL INNER JOIN ",
            "SGM S1 ON S1.GID=MRL.PID WHERE MRL.RelID=271 AND MRL.CID=S2.GID FOR XML PATH('')) R(Route) CROSS APPLY (SELECT S1.[Abbrev]+', ' FROM MRL INNER JOIN SGM S1 ON S1.GID=MRL.PID WHERE MRL.RelID=",
            "271 AND MRL.CID=S2.GID FOR XML PATH('')) V(RouteAbbrev) WHERE S2.SID=270) Z ON Z.CID=TSTF.LUAID CROSS APPLY(SELECT AMF.Name +', ' FROM TSTT INNER JOIN AMF ON TSTT.AMFID=AMF.ID WHERE ",
            "TSTT.TSTFID=TSTF.ID FOR XML PATH('')) Tech(TechName) WHERE (((((TSTF.SS IN('A','P','C')) AND ISNULL(TSTD.SCC,'')='') AND ",
            " (S13.SCC LIKE '%P%' OR (S13.GID=80 AND  (COALESCE(S3.SCC,'') LIKE '%E%' AND COALESCE(S3.SCC,'') LIKE '%D%' AND COALESCE(S3.SCC,'') LIKE '%S%')))) AND S13.GID ",
            " NOT IN(73,78)) AND ISNULL(TSTF.GstRevG231,0)=0) AND ((TXDT.IsIM=0 AND ISNULL(TSTD.GstXID,0)=0) OR (TXDT.IsIM=1 AND TSTD.GstXID>0)) ",
            " ) T WHERE @TrxDT @LastSync Status='Posted' AND Z_OAmt<>0 AND DocType  IN('Invoice','Debit Note','Credit Note','Expense Note','Expense Debit','Expense Credit') AND TrxDT>='2025-07-01' "," ORDER BY InputDT, ID, DocDT,Doc_No, Z_ID "].join(' ');          

var sibclient = [
        "SELECT @LIMIT 0 as ID, (case when isnull(a.ogid,0)=0 and isnull(h.ogid,0)<>0 then left(hg.description,3) when ISNULL(o.id,0)=0 then 'SIB' when o.id=1 then 'HQ' when o.parent is null then right(o.name,2) else left(o.description,3) end) AS OGCode,",
        "(case when isnull(a.ogid,0)=0 and isnull(h.ogid,0)<>0 then hg.description when ISNULL(o.id,0)=0 then 'State Insurance Brokers' else o.description end) AS OGName,",
        "a.Name, a.Abbrev, g35.[desc] as Incorporation, '' as IC_Reg_ID, cast(NULL as date) as C_Ment_Since,",
        "(case when a.G30=301 THEN 'Customer' when a.G30=302 THEN 'Insurer' when a.G30=303 THEN 'Introducer' when a.G30=304 THEN 'Salesperson' when a.G30=305 THEN 'Insurer' when a.G30=306 THEN 'Adjuster' when a.G30=307 THEN 'Reinsurer' when a.G30=308 THEN 'Cedant' when a.G30=309 THEN 'Office User' when a.G30=310 THEN 'Supplier' when a.G30=316 THEN 'Co-Broker' else 'General' end) as Type,",
        "a.DOB as Birthdate, g31.[desc] as Class, cast(NULL as varchar) as Sales, g32.[desc] as Industry, g33.[desc] as Nature, (case when len(isnull(a.add1,''))=0 then 'No address' else a.Add1 end) as Add1, a.Add2, a.Add3, '' as Post_Code, a.Add4 as State, ISNULL(g8.[desc],'Malaysia') as Country,",
        "LTRIM(RTRIM((case when patindex('%@%',a.Email)=0 THEN 'noemail@noemail.noemail' WHEN patindex('%,%',replace(a.Email,'/',','))>0 then substring(a.Email,1,patindex('%,%',replace(a.Email,'/',','))-1) when RTRIM(ISNULL(a.Email,''))='' THEN 'noemail@noemail.noemail' else rtrim(a.Email) end))) as Email, ISNULL(a.Phone,'') as Office_Phone, '' as House_Phone, ISNULL(a.PhoneMob,'') as Mobile_Phone, ISNULL(a.Fax,'') AS Fax,",
        "a.Contact, '' as Position, '' as Gender, NULL as Salutation, a.TaxNo as Tax_No, ISNULL(replace(RTRIM(a.CurrCode),'RM','MYR'),'MYR') as Currency_Code, a.AccNo, a.BActNo1 as BankAcc1, a.BActNo2 as BankAcc2, NULL as Credit_Terms, '' as Notes",
        "from amf a LEFT JOIN OGM o on o.ID=a.OGID LEFT JOIN SGM g31 on g31.gid=a.G31 LEFT JOIN SGM g32 on g32.gid=a.G32 LEFT JOIN SGM g33 on g33.gid=a.G33",
        "LEFT JOIN SGM g35 on g35.gid=a.G35 LEFT JOIN SGM g8 on g8.gid=a.Country LEFT JOIN amf h on h.accno=a.handler LEFT JOIN ogm hg on hg.ID=h.OGID",
        "WHERE @LastSync (a.G30 IN(302,303,316) OR (a.G30 IN(301) AND a.accno in(select accno from AOF where docdt>='2025-07-01' and acctype='C' and trxseq=0 and OBrDisc<>0) and a.G31=312))"
].join(' ');


var sibtrade = [
        "SELECT @LIMIT 0 as ID, a.InputDT, r.DocDT as TrxDT, 'un' AS Z_UOM,",
        "(case when isnull(r.ogid,0)=0 then 'SIB' when o.id=1 then 'HQ' when o.parent is null then right(o.name,2) else left(o.description,3) end) AS OGCode,",
        "(case when isnull(r.ogid,0)=0 then 'State Insurance Brokers' else o.description end) AS OGName,",
        "(case when r.doctype='B' AND r.OTGB>0 then 'Invoice' when r.OTGB<0 then 'Credit Note' else 'Debit Note' end) as Doc_Type,",
        "r.udno as Doc_No, ISNULL(r.RefNo,r.dcnno) as RefNo, (case when r.doctype='B' then NULL else x.udno end) as XDoc_No, u.UWCode as AccNo, u.UWName as Name, r.DocDT, r.Narration, '' as Handler, 0 as GST_Inclusive, REPLACE(RTRIM(r.CCPrm),'RM','MYR') as Currency, r.ERPrm AS ex_rate, r.OTGB  as TotalAmount, '0D' as Terms, '' as Order_No, '' as Set_Title, r.EndEffDate as StartDT, r.EndExpDate as EndDT, datediff(month,r.EndEffDate,r.EndExpDate) as Period,",
        "'Bill Items' as Trx_Type, 'BROKERAGE ' + cast(u.GB as varchar) +'%'+(case when len(isnull(u.polno,'')+isnull(m.coverno,''))>0 then ' FOR ' + isnull(u.polno,'')+(case when len(u.polno+m.coverno)>0 then '/' else '' end)+isnull(m.coverno,'') else '' end) as Trx_Desc, NULL as Item, 1 as Qty, r.OTGB as Price, r.OTGB as Amount, '2220904' as Tax1, 0 as Tax1_Rate, 0 as Tax1_Amount, '' as Tax1_GL",
        "FROM rnf r INNER JOIN UDF u on u.docno=r.docno INNER JOIN AOF a ON a.docno=r.docno and a.accno=u.uwcode LEFT JOIN MDF m on m.docno=r.docno LEFT JOIN OGM o on o.ID=r.OGID",
        "left join rnf x on x.docno=((r.docno/100)*100)",
        "where @LastSync r.SS='P' AND r.TS='A' AND a.TrxSeq=0 AND u.leader=1 and len(r.udno)>0 and r.OTGB<>0 AND r.docdt>='2025-07-01' and r.doctype in ('B','A','E') ORDER BY a.InputDT, r.docdt"
].join(' ');

var sibbdtrade = [
        "SELECT @LIMIT 0 as ID, a.InputDT, r.DocDT as TrxDT, 'un' AS Z_UOM,",
        "(case when isnull(r.ogid,0)=0 then 'SIB' when o.id=1 then 'HQ' when o.parent is null then right(o.name,2) else left(o.description,3) end) AS OGCode,",
        "(case when isnull(r.ogid,0)=0 then 'State Insurance Brokers' else o.description end) AS OGName,",
        "(case when r.doctype='B' AND r.OBrDisc>0 then 'Self-Billed Invoice' when r.OBrDisc<0 then 'Self-Billed Credit Note' else 'Self-Billed Debit Note' end) as Doc_Type,",
        "'BD'+r.udno as Doc_No, ISNULL(r.RefNo,r.dcnno) as RefNo, (case when r.doctype='B' then NULL else 'BD'+x.udno end) as XDoc_No, r.ClientNo as AccNo, r.ClientName as Name, r.DocDT, r.Narration, '' as Handler, 0 as GST_Inclusive, REPLACE(RTRIM(r.CCPrm),'RM','MYR') as Currency, r.ERPrm AS ex_rate, r.OBrDisc  as TotalAmount, '0D' as Terms, '' as Order_No, '' as Set_Title, r.EndEffDate as StartDT, r.EndExpDate as EndDT, datediff(month,r.EndEffDate,r.EndExpDate) as Period,",
        "'Bill Items' as Trx_Type, 'DISCOUNT ' + cast(r.BrDisc as varchar) +'%'+(case when len(isnull(u.polno,'')+isnull(m.coverno,''))>0 then ' FOR ' + isnull(u.polno,'')+(case when len(u.polno+m.coverno)>0 then '/' else '' end)+isnull(m.coverno,'') else '' end) as Trx_Desc, NULL as Item, 1 as Qty, r.OBrDisc as Price, r.OBrDisc as Amount, '2220904' as Tax1, 0 as Tax1_Rate, 0 as Tax1_Amount, '' as Tax1_GL",
        "FROM rnf r INNER JOIN AMF f ON f.AccNo=r.ClientNo INNER JOIN UDF u on u.docno=r.docno INNER JOIN AOF a ON a.docno=r.docno and a.accno=r.clientno LEFT JOIN MDF m on m.docno=r.docno LEFT JOIN OGM o on o.ID=r.OGID",
        "left join rnf x on x.docno=((r.docno/100)*100)",
        "where @LastSync r.SS='P' AND r.TS='A' AND a.TrxSeq=0 AND u.leader=1 and len(r.udno)>0 and r.OBrDisc<>0 AND f.G31=312 AND r.docdt>='2025-07-01' and r.doctype in ('B','A','E') ORDER BY a.InputDT, r.docdt"
].join(' ');

var sibsbtrade = [
        "SELECT @LIMIT 0 as ID, a.InputDT, r.DocDT as TrxDT, 'un' AS Z_UOM,",
        "(case when isnull(r.ogid,0)=0 then 'SIB' when o.id=1 then 'HQ' when o.parent is null then right(o.name,2) else left(o.description,3) end) AS OGCode,",
        "(case when isnull(r.ogid,0)=0 then 'State Insurance Brokers' else o.description end) AS OGName,",
        "(case when r.doctype='B' AND sb.OFee>0 then 'Self-Billed Invoice' when sb.OFee<0 then 'Self-Billed Credit Note' else 'Self-Billed Debit Note' end) as Doc_Type,",
        "'SB'+r.udno as Doc_No, ISNULL(r.RefNo,r.dcnno) as RefNo, (case when r.doctype='B' then NULL else 'SB'+x.udno end) as XDoc_No, sb.SBCode as AccNo, sb.SBName as Name, r.DocDT, r.Narration, '' as Handler, 0 as GST_Inclusive, REPLACE(RTRIM(r.CCPrm),'RM','MYR') as Currency, r.ERPrm AS ex_rate, sb.OFee  as TotalAmount, '0D' as Terms, '' as Order_No, '' as Set_Title, r.EndEffDate as StartDT, r.EndExpDate as EndDT, datediff(month,r.EndEffDate,r.EndExpDate) as Period,",
        "'Bill Items' as Trx_Type, 'FEES ' + cast(sb.Fee as varchar) +'%'+(case when len(isnull(u.polno,'')+isnull(m.coverno,''))>0 then ' FOR ' + isnull(u.polno,'')+(case when len(u.polno+m.coverno)>0 then '/' else '' end)+isnull(m.coverno,'') else '' end) as Trx_Desc, NULL as Item, 1 as Qty, sb.OFee as Price, sb.OFee as Amount, '2220904' as Tax1, 0 as Tax1_Rate, 0 as Tax1_Amount, '' as Tax1_GL",
        "FROM rnf r INNER JOIN UDF u on u.docno=r.docno INNER JOIN IDF sb ON sb.docno=r.docno INNER JOIN AOF a ON a.docno=r.docno and a.accno=sb.SBCode LEFT JOIN MDF m on m.docno=r.docno LEFT JOIN OGM o on o.ID=r.OGID",
        "left join rnf x on x.docno=((r.docno/100)*100)",
        "where @LastSync r.SS='P' AND r.TS='A' AND a.TrxSeq=0 AND u.leader=1 and len(r.udno)>0 and sb.OFee<>0 AND r.docdt>='2025-07-01' and r.doctype in ('B','A','E') ORDER BY a.InputDT, r.docdt"
].join(' ');

var sibcbtrade = [
        "SELECT @LIMIT 0 as ID, a.InputDT, r.DocDT as TrxDT, 'un' AS Z_UOM,",
        "(case when isnull(r.ogid,0)=0 then 'SIB' when o.id=1 then 'HQ' when o.parent is null then right(o.name,2) else left(o.description,3) end) AS OGCode,",
        "(case when isnull(r.ogid,0)=0 then 'State Insurance Brokers' else o.description end) AS OGName,",
        "(case when r.doctype='B' AND cb.OFee>0 then 'Self-Billed Invoice' when cb.OFee<0 then 'Self-Billed Credit Note' else 'Self-Billed Debit Note' end) as Doc_Type,",
        "'CB'+r.udno as Doc_No, ISNULL(r.RefNo,r.dcnno) as RefNo, (case when r.doctype='B' then NULL else 'CB'+x.udno end) as XDoc_No,(case when left(cb.CBCode,4)='OCBC' THEN 'OCBC-1' ELSE cb.CBCode END) as AccNo, cb.CBName as Name, r.DocDT, r.Narration, '' as Handler, 0 as GST_Inclusive, REPLACE(RTRIM(r.CCPrm),'RM','MYR') as Currency, r.ERPrm AS ex_rate, cb.OFee  as TotalAmount, '0D' as Terms, '' as Order_No, '' as Set_Title, r.EndEffDate as StartDT, r.EndExpDate as EndDT, datediff(month,r.EndEffDate,r.EndExpDate) as Period,",
        "'Bill Items' as Trx_Type, 'FEES ' + cast(cb.Fee as varchar) +'%'+(case when len(isnull(u.polno,'')+isnull(m.coverno,''))>0 then ' FOR ' + isnull(u.polno,'')+(case when len(u.polno+m.coverno)>0 then '/' else '' end)+isnull(m.coverno,'') else '' end) as Trx_Desc, NULL as Item, 1 as Qty, cb.OFee as Price, cb.OFee as Amount, '2220904' as Tax1, 0 as Tax1_Rate, 0 as Tax1_Amount, '' as Tax1_GL",
        "FROM rnf r INNER JOIN UDF u on u.docno=r.docno INNER JOIN CBF cb ON cb.docno=r.docno INNER JOIN AOF a ON a.docno=r.docno and a.accno=cb.CBCode LEFT JOIN MDF m on m.docno=r.docno LEFT JOIN OGM o on o.ID=r.OGID",
        "left join rnf x on x.docno=((r.docno/100)*100)",
        "where @LastSync r.SS='P' AND r.TS='A' AND a.TrxSeq=0 AND u.leader=1 and len(r.udno)>0 and cb.OFee<>0 AND r.docdt>='2025-07-01' and r.doctype in ('B','A','E') ORDER BY a.InputDT, r.docdt"
].join(' ');


var pcoclient = ["SELECT @LIMIT ID, OG.UGC AS OGCode,OG.[Desc] AS OGName,AccNo,Status,Name,AMF.Abbrev,CSince AS [C_Ment_Since],",
        "OPhone AS [Office_Phone], HPhone AS [House_Phone], Mobile AS [Mobile_Phone], Fax, Contact, (case when len(isnull(add1,''))=0 then 'No address' else Add1 end) as Add1, Add2, Add3, Zip AS [Post_Code],",
        "replace(LTRIM(RTRIM((case when patindex('%@%',Email)=0 THEN 'noemail@noemail.noemail' WHEN patindex('%,%',replace(Email,'/',','))>0 then substring(Email,1,patindex('%,%',replace(Email,'/',','))-1) when RTRIM(ISNULL(Email,''))='' THEN 'noemail@noemail.noemail' else rtrim(Email) end))),' ','.') as Email,",
        "(CASE WHEN CNT.[Desc] IS NULL THEN 'Malaysia' ELSE UPPER(SUBSTRING(CNT.[Desc],1,1))+LOWER(SUBSTRING(CNT.[Desc],2,100)) END) As [Country], NRIC AS [IC_Reg_ID], DOB AS [Birthdate], Gender,",
        "(SELECT [Desc] FROM SGM WHERE GID=State) As [State],(CASE WHEN AMF.G30=301 THEN 'Customer' WHEN AMF.G30=302 THEN 'Supplier' WHEN AMF.G30=303 THEN 'Introducer' WHEN AMF.G30=309 THEN 'Office User' WHEN AMF.G30=310 THEN 'Insurer' ELSE 'General' END) As [Type],(SELECT [Desc] FROM SGM WHERE GID=G31) As [Class],",
        "(CASE WHEN G32.[Desc]='Others' THEN 'Miscellaneous / Others' ELSE G32.[Desc] END) As [Industry], (SELECT [Desc] FROM SGM WHERE GID=G33) As [Nature], (SELECT [Desc] FROM SGM WHERE GID=G35) As [Incorporation],",
        "(SELECT Name FROM AMF As [A] WHERE A.ID=AMF.Handler) As [Sales],( SELECT Name FROM AMF As [A] WHERE A.ID=AMF.Asst) As [Asst_Sales],(SELECT AccNo FROM AMF As [A]",
        "WHERE A.ID=AMF.RefAct) As [Referral], (SELECT AccNo FROM AMF As [A] WHERE A.ID=AMF.IntroducerID) As [Introducer],(SELECT AccNo FROM AMF As [A] ",
        "WHERE A.ID=AMF.HoldAccID) As [Holding],CurrCode AS [Currency_Code], Notes, Occupation AS [Position], NULL AS Salutation, AcctContact AS [Billing_Contact],",
        "(CASE WHEN patindex('%Days%',G101.[Desc])=0 THEN 'Cash on Delivery' ELSE REPLACE(G101.[Desc],'Days','Days Credit Term') END) As [Credit_Terms],",
        "CrLimit As [Credit_Limit],TaxNo As [Tax_No], NULL As [InTax_Code],",
        "NULL As [OutTax_Code],GSTSBNo As [SelfBill_No],GstSBEff As [SelfBill_Effective],  GstSBExp As [SelfBill_Expiry],GstRegDT As [Gst_Reg_Date],",
        "BActNo1 As [BankAcc1],BActNo2 As [BankAcc2],(SELECT [Desc] FROM SGM WHERE GID=G36) As [NRIC_Type] ", "FROM AMF LEFT JOIN SGM OG ON AMF.OGID=OG.GID",
        "LEFT JOIN SGM CT ON CT.GID = AMF.G30 LEFT JOIN SGM CNT ON CNT.GID = AMF.Country LEFT JOIN SGM G32 ON G32.GID=AMF.G32 LEFT JOIN SGM G101 ON G101.GID=AMF.G101 WHERE @LastSync CT.[Desc] IN('Customer') AND (AMF.ID IN(SELECT ACCID FROM AOF WHERE DocDT>='2025-07-01' AND TrxSeq=0) OR AMF.ID IN(SELECT CustID FROM CMF WHERE year(ExpDT)>=year(GetDate()) )) ORDER BY ID"].join(' ');

var pcotrade = [ "SELECT @LIMIT ID, InputDT, TrxDT, OGCode,OGName, UpdateDT, Z_ID, Z_ODisc,",
        "(CASE WHEN DocType ='Expense Note' THEN 'Self-Billed Invoice' when DocType = 'Expense Debit' then 'Self-Billed Debit Note' when DocType = 'Expense Credit' THEN 'Self-Billed Credit Note' WHEN DocType='Cash Sales' THEN 'Invoice' WHEN DocType='Cash Debit' THEN 'Debit Note' WHEN DocType='Cash Credit' THEN 'Credit Note' ELSE DocType end) as Doc_Type, UDNo as Doc_No, RefNo as RefNo, AccNo as AccNo, AcctName as Name, TrxDT as DocDT," ,
        "CCID as Currency, ex_rate, (CASE WHEN patindex('%Days%',PymtTerms)=0 THEN '0D' ELSE ISNULL(PymtTermsAbbrev,'0D') END) as Terms, Z_Desc as Trx_Desc, Z_Code as Item,",
        "Z_Qty as Qty, Z_OPrice as Price, Z_OAmt as Amount, (CASE WHEN Z_Tax1 IN('NT','NR','PNT','OS','OP','ZP','ZRL','ZRE') THEN 'TAXEXMPT' ELSE Z_Tax1 END) as Tax1, Z_Tax1Pct as Tax1_Rate, Z_OTax1 as Tax1_Amount, Status,",
        "(CASE WHEN Z_UOM='BOX/ES' THEN 'box' WHEN Z_UOM='PC/S' THEN 'piece' WHEN Z_UOM='MONTHLY' THEN 'mnt' WHEN Z_UOM='YEARLY' THEN 'yr' WHEN Z_UOM='LITRE/S' THEN 'L' WHEN Z_UOM='CAN' THEN 'bottle' WHEN Z_UOM='TUBE/S' THEN 'tube' WHEN Z_UOM='BOTTLE/S' THEN 'bottle' WHEN Z_UOM='PACKET(S)' THEN 'pckt' WHEN Z_UOM='tin(s)' THEN 'bottle' WHEN Z_UOM='BI-MONTHLY' THEN 'bm' WHEN Z_UOM='SEMI-ANNUALY' THEN 'hy' WHEN Z_UOM='QUARTERLY' THEN 'qr' WHEN Z_UOM='ml' THEN 'mL' WHEN Z_UOM='KG' THEN 'kg' WHEN Z_UOM='gram' THEN 'g' WHEN Z_UOM='ROLL/S' THEN 'RL' WHEN Z_UOM='VISIT/S' THEN 'vs' WHEN Z_UOM='LUMP SUM' THEN 'LS' WHEN Z_UOM='SERVICE/S' THEN 'svc' WHEN Z_UOM='PACK/S' THEN 'pckt' WHEN Z_UOM='MÂ²' THEN 'm^2' ELSE 'un' END) AS Z_UOM,",
        "OldUDNo as XDoc_No FROM ( SELECT OG.UGC as OGCode, OG.[Desc] as OGName, TSTF.UpdateDT, TSTF.OGID,TSTF.ID,TSTF.CMFID,TSTF.DONo,TSTF.CustRef, TSTF.RefNo,TSTF.Header,TSTF.Remarks,",
        "TSTF.DONotes,TSTF.PhO,TSTF.PhH,TSTF.PhM,TSTF.Fax,TSTF.Email,TSTF.Contact,TSTF.Info,TSTF.Info2,TSTF.Rating,TSTF.DelDT,TSTF.StartDT,TSTF.EndDT,TSTF.Period,TSTF.Narration,",
        "ISNULL(A.InputDT,TSTF.InputDT) AS InputDT, ISNULL(A.ER,1) AS ex_rate, TSTF.EnterBy,TSTF.FeedBack,TSTF.DelNo,TSTF.IsBadDebt,TSTF.GstDT,TSTF.GSTIncl,TSTF.GstSimp,TSTF.GstSBNo,TXDT.TrxDT,(CASE WHEN TSTF.G2=49 THEN 1 ELSE 0 END) As [GstGift],",
        "TSTF.G2 As [DocG2],TSTF.Duration/60 As [Duration],OTSTF.UDNo As [OldUDNo],CMF.UDNo+'/'+RIGHT('00'+CAST((SELECT COUNT(*) FROM CLD D WHERE D.CMFID=CMF.ID AND D.ID<=CLD.ID) AS VARCHAR),2) ",
        "As [SetUDNo],OTSTF.GstDT As [OldGstDT],OTSTF.TrxDT As [OldTrxDT],OTSTF.OAmt As [OldOAmt],OTSTF.CCID As [OldCCID],CMF.EffDT,CMF.ExpDT,CMF.RenNo,CMF.CustName As [Customer],CMF.UDNo As ",
        "[Contract_No],CMF.Remarks As [Title],AMF1.Name As [SalesName],AMF1.Abbrev As [SalesA],S16.[Desc] As [OrderStatus],S20.[Desc] As [OrderType],S20.Abbrev As [OrderTypeAbbrev],S20.UGC As ",
        "[OrderTypeUGC],CLD.RetentionP,CLD.CommP,CLD.OComm,CLD.LComm,CLD.OAmt As [OrderSetAmt],CLD.Title As [OrderSetTitle],CLD.Billing As [PaymentFreq],CLD.Freq,S12.[Desc] As ",
        "[PaymentMode],SAL.G216Desc As [Salutation],SAL.G205Desc As [PremiseType],REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE('[Add1]'+' '+'[Add2]'+' '+'[Add3]'+' ",
        "'+'[ZIP] [State]'+' '+'[Country].','[Add1]',ISNULL(CLD.Add1,'')),'[Add2]',ISNULL(CLD.Add2,'')),'[Add3]',ISNULL(CLD.Add3,'')),'[State]',ISNULL(S14.[Desc],'')),'[Zip]',ISNULL(CLD.Zip,'')), ",
        "'[Country]',ISNULL(S14CT.[Desc],'')),''+' '+''+' '+''+' '+'',''+' '+''),''+' '+''+' '+'',''+' '+''),''+' '+'','Â '+' '+'') As [LocAddress],dbo.GetDeliverables(CLD.ID) As ",
        " [Deliverables],AB.UDNo As [AutoBillTempNo],CASE TSTF.SS WHEN 'P' THEN (CASE WHEN TSTF.TS='C' THEN 'Cancelled' ELSE 'Posted' END) WHEN 'C' THEN 'Cancelled' WHEN 'T' THEN 'Template' ELSE ",
        "(CASE WHEN TSTF.TS='D' THEN 'Draft' ELSE 'Active' END) END As [Status],CAST(0 AS MONEY)OTInMinute,CAST(0 AS MONEY)OTInMinuteHoliday,DATENAME(dw,TSTF.StartDT) As [WeekDayName],(CASE WHEN ",
        "(SELECT COUNT(*) FROM HOL WHERE HOL.Title NOT IN('Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday') AND TSTF.StartDT>=HOL.StartDT AND ",
        "HOL.EndDT>=dbo.dateserial(DAY(TSTF.StartDT),MONTH(TSTF.StartDT),YEAR(TSTF.StartDT)))>0 THEN 1 ELSE 0 END) As [IsHoliday],S.[Desc] As [Status2],S1.[Desc] As [ServiceNature],S2.[Desc] As ",
        "[WorkType],S3.[Desc] As [StockNoteType],A.GLID,A.PDDT As [DueDT],S15.[UGC] As [GLCode],S15.[Desc] As [GLName],(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN 1 ELSE 0 END) AS IsNegate, ",
        "S13.[Desc] As [DocType],(CASE WHEN S13.SCC LIKE '%S%' THEN 1 WHEN S3.SCC LIKE '%S%' THEN 1 ELSE 0 END) As [ForSales],(CASE WHEN S13.SCC LIKE '%O%' THEN 1 WHEN S3.SCC LIKE '%O%' THEN 1 ",
        "ELSE 0 END) As [ForPurchase],S17.[Desc] As [PymtTerms],ISNULL(S17.UGC,S17.Abbrev) As [PymtTermsAbbrev],(CASE COALESCE(TSTD.SCC,'') WHEN '' THEN 'Bill Items' WHEN 'S' THEN 'Servicing' WHEN 'T' THEN ",
        "'Tracking' WHEN 'P' THEN 'Payment' ELSE 'Unknown' END) As [Z_TypeDesc],COALESCE(TSTD.SCC,'A') As [Z_Type],TSTD.ID As [Z_ID],TSTD.[Desc] As [Z_Desc],TSTD.Qty As [Z_Qty],TSTD.LastQty As ",
        "[Z_LastQty],TSTD.Qty-ISNULL(TSTD.LastQty,'') As [Z_UsageQty],TSTD.StockID As [Z_StockID],TSTD.RefNo As [Z_RefNo],TSTD.Rates As [Z_Rates],TSTD.ETA As [Z_ETA],TSTD.Tag As ",
        "[Z_Tag],TSTD.BatchNo As [Z_BatchNo],BT.TrxDT As [Z_BatchDT],BT.GstDT As [Z_GstDT],BT.OAmt As [Z_BatchOAmt],BT.LAmt As [Z_BatchLAmt],TSTD.StartDT As [Z_StartDT],TSTD.EndDT As ",
        "[Z_EndDT],TSTD.Duration/60 As [Z_Duration],TSTD.CommPct As [Z_CommPct],TSTD.DiscPct As [Z_DiscPct],TSTD.Tax1Pct As [Z_Tax1Pct],TSTD.Tax2Pct As [Z_Tax2Pct],S4.[UGC] As [Z_UOM],S5.[Desc] As ",
        "[Z_Status],S6.[Desc] As [Z_Action],S7.[Desc] As [Z_Area],S8.[Desc] As [Z_Target],S9.[UGC] As [Z_GLCode],S9.[Desc] As [Z_GLName],S9T.[Desc] As [Z_GLType],(CASE WHEN S9T.SCC LIKE '%A%' THEN ",
        " 1 ELSE 0 END) As [Z_IsCapital],PDS.Name As [Z_Name],PDS.Code As [Z_Code],PDS.BarCode As [Z_BarCode],S58.UGC As [StockTariffCode],S58.[Desc] As [StockTariffDesc],S10.[Desc] As ",
        "[Z_StockType],S10.SCC As [Z_StockSCC],S11.[Desc] As [Z_StockNoteType],Z.Route, Z.Zone, ISNULL(Z.Route + ' - ','') + ISNULL(Z.Zone,'') AS RouteZone, Z.RouteAbbrev, Z.ZoneUGC, Z.ZoneAbbrev,",
        "Z.ZoneState, Z.ZoneStateAbbrev,OG1.[Desc] As [OG_Name],OG2.[Desc] As [OG_Name_Order],OG3.[Desc] As [OG_Name_OrderSet],(CASE WHEN LEN(ISNULL(Tech.TechName,''))>0 THEN ",
        "LEFT(ISNULL(Tech.TechName,' '), LEN(ISNULL(Tech.TechName,' '))-1) ELSE '' END) As [TechName],B.LastARAP_Date,S31.[Desc] As [Account_Type],S35.[Desc] As [Acct_Inc],S35.UGC As ",
        "[Acct_Inc_UGC],(CASE WHEN AMF.Name LIKE '%takaful%' THEN 1 ELSE 0 END) As [Takaful],H.Name as HandlerName,TSTF.PostHandler, ",
        "(CASE WHEN TXDT.IsIM=1 THEN OTSTF.UDNo+'(K1)' ELSE (CASE WHEN ISNULL(STK.IsDO,0)=1 THEN TSTD.BatchNo ELSE (CASE WHEN LEN(TSTF.DONo)>0 AND TSTF.G2=80 THEN TSTF.DONo ELSE TSTF.UDNo END) END) ",
        "END) AS UDNo,(CASE WHEN TXDT.IsIM=1 THEN OTSTF.AcctID ELSE TSTF.AcctID END) AS AcctID,(CASE WHEN TXDT.IsIM=1 THEN OTSTF.AcctName ELSE TSTF.AcctName END) AS AcctName,(CASE WHEN TXDT.IsIM=1 ",
        "THEN OTSTF.CCID ELSE TSTF.CCID END) AS CCID,TXDT.GstRef, (CASE WHEN TXDT.IsIM=1 THEN OAMF.AccNo ELSE AMF.AccNo END) AS AccNo,(CASE WHEN TXDT.IsIM=1 THEN OAMF.NRIC ELSE AMF.NRIC END) AS ",
        "NRIC,(CASE WHEN TXDT.IsIM=1 THEN OAMF.OldNRIC ELSE AMF.OldNRIC END) AS OldNRIC,(CASE WHEN TXDT.IsIM=1 THEN OAMF.TaxNo ELSE AMF.TaxNo END) AS TaxNo,(CASE WHEN TXDT.IsIM=1 THEN OAMF.Email ",
        "ELSE AMF.Email END) AS MailTo,(CASE WHEN TXDT.IsIM=1 THEN S23.[Desc] ELSE S25.[Desc] END) AS ContactState,(CASE WHEN TXDT.IsIM=1 THEN S24.[Desc] ELSE S26.[Desc] END) AS ",
        "ContactCountry,(CASE WHEN TXDT.IsIM=1 THEN (CASE WHEN OAMF.G31=311 THEN OAMF.NRIC ELSE '' END) ELSE (CASE WHEN AMF.G31=311 THEN AMF.NRIC ELSE '' END) END) AS BusReg, ",
        "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTF.OAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS OAmt,(CASE WHEN ",
        "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTF.LAmt As [LAmt], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTF.OGross/(CASE WHEN TXDT.IsIM=1 ",
        "AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS OGross,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTF.LGross As [LGross], ",
        "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTF.OAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
        "OTSTF.ER ELSE 1 END),2) AS OAmtN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTF.LAmt As [LAmtN], ",
        "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTF.OGross/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
        "OTSTF.ER ELSE 1 END),2) AS OGrossN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTF.LGross As [LGrossN], ",
        "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*A.OXAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS OS_OAmt,(CASE WHEN ",
        "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*A.LXAmt As [OS_LAmt], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 ",
        "THEN -1 ELSE 1 END)*A.OXAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS OS_OAmtN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN ",
        "PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*A.LXAmt As [OS_LAmtN], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*B.OXAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 ",
        "THEN OTSTF.ER ELSE 1 END),2) AS OSAsAt_OAmt,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*B.LXAmt As [OSAsAt_LAmt], ",
        "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*B.OXAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
        "OTSTF.ER ELSE 1 END),2) AS OSAsAt_OAmtN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*B.LXAmt As ",
        "[OSAsAt_LAmtN], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.OAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OAmt,(CASE WHEN ",
        "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LAmt As [Z_LAmt], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.OPrice/(CASE WHEN TXDT.IsIM=1 ",
        "AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OPrice,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LPrice As [Z_LPrice],",
        "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OAmt/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
        "OTSTF.ER ELSE 1 END),2) AS Z_OAmtN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LAmt As [Z_LAmtN],",
        "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OPrice/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
        "OTSTF.ER ELSE 1 END),2) AS Z_OPriceN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LPrice As [Z_LPriceN], ",
        "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.ODisc/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_ODisc,(CASE WHEN ",
        "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LDisc As [Z_LDisc], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.OComm/(CASE WHEN TXDT.IsIM=1 ",
        "AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OComm,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LComm As [Z_LComm], ",
        "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.ODisc/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
        "OTSTF.ER ELSE 1 END),2) AS Z_ODiscN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LDisc As [Z_LDiscN], ",
        "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OComm/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
        "OTSTF.ER ELSE 1 END),2) AS Z_OCommN,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LComm As [Z_LCommN], ",
        "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.OTax1/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax1,(CASE WHEN ",
        "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LTax1 As [Z_LTax1], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.OTax2/(CASE WHEN TXDT.IsIM=1 ",
        "AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax2,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*TSTD.LTax2 As [Z_LTax2], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR ",
        "TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OTax1/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax1N,(CASE ",
        "WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LTax1 As [Z_LTax1N], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR ",
        "TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OTax2/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax2N,(CASE ",
        "WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LTax2 As [Z_LTax2N], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR ",
        "TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OTax1/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS ",
        "Z_OTax1N_GST03,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LTax1 As [Z_LTax1N_GST03], ",
        "ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.OTax2/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
        "OTSTF.ER ELSE 1 END),2) AS Z_OTax2N_GST03,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*TSTD.LTax2 As ",
        "[Z_LTax2N_GST03], S21.Abbrev As [Z_Tax1],S21.[Desc] As [Z_Tax1Desc],(CASE WHEN S21.SCC LIKE '%I%' THEN 1 ELSE 0 END) As [Z_Tax1_InputTax],(CASE WHEN S21.SCC LIKE '%O%' THEN 1 ELSE 0 END) ",
        "As [Z_Tax1_OutputTax],(CASE WHEN S21.SCC LIKE '%R%' THEN 1 ELSE 0 END) As [Z_Tax1_IRR_Supply],(CASE WHEN S21.SCC LIKE '%E%' THEN 1 ELSE 0 END) As [Z_Tax1_IRR_Exempt],(CASE WHEN S21.SCC ",
        "LIKE '%U%' THEN 1 ELSE 0 END) As [Z_Tax1_IRR_Residual],T1.TaxGLCode As [Z_Tax1Code],T1.TaxGLName As [Z_Tax1Name], S22.Abbrev As [Z_Tax2],S22.[Desc] As [Z_Tax2Desc],(CASE WHEN S22.SCC LIKE ",
        "'%I%' THEN 1 ELSE 0 END) As [Z_Tax2_InputTax],(CASE WHEN S22.SCC LIKE '%O%' THEN 1 ELSE 0 END) As [Z_Tax2_OutputTax],(CASE WHEN S22.SCC LIKE '%R%' THEN 1 ELSE 0 END) As [Z_Tax2_IRR_Supply],",
        "(CASE WHEN S22.SCC LIKE '%E%' THEN 1 ELSE 0 END) As [Z_Tax2_IRR_Exempt], (CASE WHEN S22.SCC LIKE '%U%' THEN 1 ELSE 0 END) As [Z_Tax2_IRR_Residual],T2.TaxGLCode As [Z_Tax2Code],T2.TaxGLName ",
        "As [Z_Tax2Name], CAST(1 AS FLOAT) As [Z_IRR], ROUND((CASE WHEN TXDT.IsIM=1 THEN TT.Z_OTotalTax1X ELSE TT.Z_OTotalTax1 END)/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 ",
        " END),2) AS Z_OTotalTax1,(CASE WHEN TXDT.IsIM=1 THEN TT.Z_LTotalTax1X ELSE TT.Z_LTotalTax1 END) AS Z_LTotalTax1, ROUND((CASE WHEN TXDT.IsIM=1 THEN TT.Z_OTotalTax2X ELSE TT.Z_OTotalTax2 ",
        "END)/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTotalTax2,(CASE WHEN TXDT.IsIM=1 THEN TT.Z_LTotalTax2X ELSE TT.Z_LTotalTax2 END) AS Z_LTotalTax2, ROUND((CASE ",
        "WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(CASE WHEN TXDT.IsIM=1 THEN TT.Z_OTotalTax1X ELSE TT.Z_OTotalTax1 ",
        "END)/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTotalTax1N,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 ",
        "THEN -1 ELSE 1 END)*(CASE WHEN TXDT.IsIM=1 THEN TT.Z_LTotalTax1X ELSE TT.Z_LTotalTax1 END) As [Z_LTotalTax1N], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 ",
        " END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(CASE WHEN TXDT.IsIM=1 THEN TT.Z_OTotalTax2X ELSE TT.Z_OTotalTax2 END)/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) ",
        "AS Z_OTotalTax2N,(CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(CASE WHEN TXDT.IsIM=1 THEN TT.Z_LTotalTax2X ",
        "ELSE TT.Z_LTotalTax2 END) As [Z_LTotalTax2N], ROUND((T1.OTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG1.OTaxTAmt ELSE TG1.OTaxTAmtX END),0))/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN ",
        "OTSTF.ER ELSE 1 END),2) AS Z_OTax1Sum,T1.LTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG1.LTaxTAmt ELSE TG1.LTaxTAmtX END),0) As [Z_LTax1Sum], ROUND((T2.OTaxTAmt-ISNULL((CASE WHEN ",
        "TXDT.IsIM=1 THEN TG2.OTaxTAmt ELSE TG2.OTaxTAmtX END),0))/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax2Sum,T2.LTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN ",
        "TG2.LTaxTAmt ELSE TG2.LTaxTAmtX END),0) As [Z_LTax2Sum], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 ",
        "END)*(T1.OTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG1.OTaxTAmt ELSE TG1.OTaxTAmtX END),0))/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax1SumN,(CASE WHEN ",
        "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(T1.LTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG1.LTaxTAmt ELSE ",
        "TG1.LTaxTAmtX END),0)) As [Z_LTax1SumN], ROUND((CASE WHEN ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(T2.OTaxTAmt - ",
        "ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG2.OTaxTAmt ELSE TG2.OTaxTAmtX END),0))/(CASE WHEN TXDT.IsIM=1  AND OTSTF.ER>0 THEN OTSTF.ER ELSE 1 END),2) AS Z_OTax2SumN,(CASE WHEN ",
        "ISNULL(STK.IsDO,0)=1 OR TXDT.IsDP=1 THEN -1 ELSE 1 END)*(CASE WHEN PATINDEX('%N%',S13.SCC)>0 THEN -1 ELSE 1 END)*(T2.LTaxTAmt-ISNULL((CASE WHEN TXDT.IsIM=1 THEN TG2.LTaxTAmt ELSE ",
        "TG2.LTaxTAmtX END),0)) As [Z_LTax2SumN] ,(CASE WHEN S9.GID>0 THEN (CASE WHEN S9.GID=S18.GID THEN S18.UGC ELSE S19.UGC END) ELSE S18.UGC END) As [DrGL],(CASE WHEN S9.GID>0 THEN (CASE WHEN ",
        "S9.GID=S19.GID THEN S19.UGC ELSE S18.UGC END) ELSE S19.UGC END) As [CrGL],(CASE WHEN LEN(ISNULL(SN.SNo,''))>0 THEN LEFT(ISNULL(SN.SNo,' '), LEN(ISNULL(SN.SNo,' '))-1) ELSE '' END) As ",
        "[Z_SerialNo] FROM TSTF INNER JOIN AMF ON TSTF.AcctID=AMF.ID INNER JOIN AMF H ON TSTF.Handler= H.ID LEFT JOIN CMF ON TSTF.CMFID=CMF.ID LEFT JOIN AMF AMF1 ON CMF.Sales= AMF1.ID LEFT JOIN CLD ",
        "ON TSTF.CLDID=CLD.ID LEFT JOIN SGM S1 ON TSTF.G207= S1.GID LEFT JOIN SGM S2 ON TSTF.G208= S2.GID LEFT JOIN SGM S3 ON TSTF.G250= S3.GID INNER JOIN TSTD ON TSTF.ID=TSTD.TSTFID LEFT JOIN SGM ",
        "S4 ON TSTD.UOM= S4.GID LEFT JOIN SGM S5 ON TSTD.G199= S5.GID LEFT JOIN SGM S6 ON TSTD.G201= S6.GID LEFT JOIN SGM S7 ON TSTD.G202= S7.GID LEFT JOIN SGM S8 ON TSTD.G206= S8.GID LEFT JOIN SGM ",
        "S9 ON TSTD.GLID= S9.GID LEFT JOIN SGM S31 ON AMF.G31= S31.GID LEFT JOIN SGM S35 ON AMF.G35= S35.GID LEFT JOIN SGM S9T ON S9.Val=S9T.GID LEFT JOIN PDS ON TSTD.StockID=PDS.ID LEFT JOIN SGM ",
        "S10 ON PDS.G230= S10.GID LEFT JOIN SGM S58 ON PDS.G58= S58.GID LEFT JOIN SGM S11 ON TSTD.G250= S11.GID LEFT JOIN SGM S12 ON CLD.PaymentMode= S12.GID INNER JOIN SGM S13 ON TSTF.G2= S13.GID ",
        "LEFT JOIN SGM S14 ON CLD.State= S14.GID LEFT JOIN SGM S14CT ON CLD.Country= S14CT.GID LEFT JOIN TSTF BT ON TSTD.BatchID= BT.ID LEFT JOIN SGM S16 ON CMF.G203= S16.GID LEFT JOIN SGM S17 ON ",
        "TSTF.PymtTerms= S17.GID LEFT JOIN SGM S20 ON CMF.G200= S20.GID LEFT JOIN SGM S23 ON TSTF.State= S23.GID LEFT JOIN SGM S24 ON TSTF.Country= S24.GID LEFT JOIN SGM OG1 ON TSTF.OGID= OG1.GID ",
        "LEFT JOIN SGM OG2 ON CMF.OGID= OG2.GID LEFT JOIN SGM OG3 ON CLD.OG= OG3.GID LEFT JOIN TSTF AB ON CLD.AB_TSTFID= AB.ID LEFT JOIN TSTF OTSTF ON TSTF.OldDocNo= OTSTF.ID LEFT JOIN AMF OAMF ON ",
        "OAMF.ID=OTSTF.AcctID LEFT JOIN SGM S25 ON S25.GID=OTSTF.State LEFT JOIN SGM S26 ON S26.GID=OTSTF.Country LEFT JOIN (SELECT TSTFID,SUM(CASE WHEN GstXID>0 THEN 0 ELSE OTax1 END) As ",
        "[Z_OTotalTax1],SUM(CASE WHEN GstXID>0 THEN 0 ELSE LTax1 END) As [Z_LTotalTax1],SUM(CASE WHEN GstXID>0 THEN 0 ELSE OTax2 END) As [Z_OTotalTax2],SUM(CASE WHEN GstXID>0 THEN 0 ELSE LTax2 END) ",
        "As [Z_LTotalTax2],SUM(CASE WHEN GstXID>0 THEN OTax1 ELSE 0 END) As [Z_OTotalTax1X],SUM(CASE WHEN GstXID>0 THEN LTax1 ELSE 0 END) As [Z_LTotalTax1X],SUM(CASE WHEN GstXID>0 THEN OTax2 ELSE 0 ",
        "END) As [Z_OTotalTax2X],SUM(CASE WHEN GstXID>0 THEN LTax2 ELSE 0 END) As [Z_LTotalTax2X] FROM TSTD GROUP BY TSTFID) TT ON TT.TSTFID=TSTF.ID LEFT JOIN (SELECT TSTFID,TSTD.T1G60 As ",
        "[TGID],(CASE WHEN CHARINDEX('L',S.SCC)>0 THEN TSTD.GLID ELSE NULL END) AS TGLID,SUM(CASE WHEN GstXID>0 THEN 0 ELSE OTax1 END) As [OTaxTAmt],SUM(CASE WHEN GstXID>0 THEN 0 ELSE LTax1 END) As ",
        "[LTaxTAmt],SUM(CASE WHEN GstXID>0 THEN OTax1 ELSE 0 END) As [OTaxTAmtX],SUM(CASE WHEN GstXID>0 THEN LTax1 ELSE 0 END) As [LTaxTAmtX] FROM TSTD LEFT JOIN SGM S ON TSTD.T1G60= S.GID GROUP BY ",
        "TSTFID,TSTD.T1G60,(CASE WHEN CHARINDEX('L',S.SCC)>0 THEN TSTD.GLID ELSE NULL END)) TG1 ON TG1.TSTFID=TSTF.ID AND TG1.TGID=TSTD.T1G60 AND ",
        "ISNULL(TSTD.GLID,0)=ISNULL(TG1.TGLID,ISNULL(TSTD.GLID,0)) LEFT JOIN (SELECT TSTFID,TSTD.T2G60 As [TGID],(CASE WHEN CHARINDEX('L',S.SCC)>0 THEN TSTD.GLID ELSE NULL END) AS TGLID,SUM(CASE WHEN ",
        "GstXID>0 THEN 0 ELSE OTax2 END) As [OTaxTAmt],SUM(CASE WHEN GstXID>0 THEN 0 ELSE LTax2 END) As [LTaxTAmt],SUM(CASE WHEN GstXID>0 THEN OTax2 ELSE 0 END) As [OTaxTAmtX],SUM(CASE WHEN GstXID>0 ",
        "THEN LTax2 ELSE 0 END) As [LTaxTAmtX] FROM TSTD LEFT JOIN SGM S ON TSTD.T2G60= S.GID GROUP BY TSTFID,TSTD.T2G60,(CASE WHEN CHARINDEX('L',S.SCC)>0 THEN TSTD.GLID ELSE NULL END)) TG2 ON ",
        "TG2.TSTFID=TSTF.ID AND TG2.TGID=TSTD.T2G60 AND ISNULL(TSTD.GLID,0)=ISNULL(TG2.TGLID,ISNULL(TSTD.GLID,0)) LEFT JOIN (SELECT TSTP.TSTFID,TSTP.G231,(CASE WHEN  (COALESCE(P.SCC,'') LIKE '%N%') ",
        "THEN 1 ELSE 0 END) As [TaxNegate],T.Abbrev As [TaxCode],T.Val As [TaxPct],T.SCC As [TaxSCC],(CASE WHEN CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.GID ELSE TDr.GID ",
        "END) ELSE NULL END) As [TaxGLID],(CASE WHEN CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.UGC ELSE TDr.UGC END) ELSE (CASE WHEN CHARINDEX('T',TDr.SCC)>0 THEN TDr.UGC ",
        "ELSE TCr.UGC END) END) As [TaxGLCode],(CASE WHEN CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.[Desc] ELSE TDr.[Desc] END) ELSE (CASE WHEN CHARINDEX('T',TDr.SCC)>0 ",
        "THEN TDr.[Desc] ELSE TCr.[Desc] END) END) As [TaxGLName],TSTP.OAmt As [OTaxTAmt],TSTP.LAmt As [LTaxTAmt] FROM TSTP LEFT JOIN SGM T ON TSTP.G231= T.GID INNER JOIN TSTF ON TSTP.TSTFID=TSTF.ID ",
        "LEFT JOIN SGM P ON TSTF.G2= P.GID LEFT JOIN SGM TDr ON TSTP.DrGL= TDr.GID LEFT JOIN SGM TCr ON TSTP.CrGL= TCr.GID WHERE TSTP.G231 IN(SELECT GID FROM SGM WHERE  SID=231 AND (COALESCE(SCC,'') ",
        "LIKE '%T%')) AND (CHARINDEX('T',TDr.SCC)>0 OR CHARINDEX('T',TCr.SCC)>0 OR CHARINDEX('L',T.SCC)>0)) T1 ON T1.TSTFID=TSTF.ID AND T1.G231=TSTD.T1G60 AND ",
        "ISNULL(TSTD.GLID,0)=ISNULL(T1.TaxGLID,ISNULL(TSTD.GLID,0)) LEFT JOIN (SELECT TSTP.TSTFID,TSTP.G231,(CASE WHEN  (COALESCE(P.SCC,'') LIKE '%N%') THEN 1 ELSE 0 END) As [TaxNegate],T.Abbrev As ",
        "[TaxCode],T.Val As [TaxPct],T.SCC As [TaxSCC],(CASE WHEN CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.GID ELSE TDr.GID END) ELSE NULL END) As [TaxGLID],(CASE WHEN ",
        "CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.UGC ELSE TDr.UGC END) ELSE (CASE WHEN CHARINDEX('T',TDr.SCC)>0 THEN TDr.UGC ELSE TCr.UGC END) END) As [TaxGLCode],(CASE ",
        "WHEN CHARINDEX('L',T.SCC)>0 THEN (CASE WHEN CHARINDEX('S',P.SCC)>0 THEN TCr.[Desc] ELSE TDr.[Desc] END) ELSE (CASE WHEN CHARINDEX('T',TDr.SCC)>0 THEN TDr.[Desc] ELSE TCr.[Desc] END) END) As ",
        "[TaxGLName],TSTP.OAmt As [OTaxTAmt],TSTP.LAmt As [LTaxTAmt] FROM TSTP LEFT JOIN SGM T ON TSTP.G231= T.GID INNER JOIN TSTF ON TSTP.TSTFID=TSTF.ID LEFT JOIN SGM P ON TSTF.G2= P.GID LEFT JOIN ",
        "SGM TDr ON TSTP.DrGL= TDr.GID LEFT JOIN SGM TCr ON TSTP.CrGL= TCr.GID WHERE TSTP.G231 IN(SELECT GID FROM SGM WHERE  SID=231 AND (COALESCE(SCC,'') LIKE '%T%')) AND (CHARINDEX('T',TDr.SCC)>0 ",
        "OR CHARINDEX('T',TCr.SCC)>0 OR CHARINDEX('L',T.SCC)>0)) T2 ON T2.TSTFID=TSTF.ID AND T2.G231=TSTD.T2G60 AND ISNULL(TSTD.GLID,0)=ISNULL(T1.TaxGLID,ISNULL(TSTD.GLID,0)) LEFT JOIN SGM S21 ON ",
        "S21.GID=TSTD.T1G60 LEFT JOIN SGM S22 ON S22.GID=TSTD.T2G60 LEFT JOIN (SELECT PID,CID,0 AS IsDO FROM TSTF INNER JOIN TSTP ON TSTF.ID=TSTP.TSTFID INNER JOIN MRL ON TSTP.TSTFID=MRL.CID WHERE ",
        "TSTF.SS='P' AND RelID=2 AND G231 IN(SELECT GID FROM SGM WHERE  SID=231 AND (COALESCE(SCC,'') LIKE '%T%')) UNION ALL SELECT PID,CID,1 AS IsDO FROM TSTF INNER JOIN TSTP ON TSTF.ID=TSTP.TSTFID ",
        "INNER JOIN MRL ON TSTP.TSTFID=MRL.CID WHERE TSTF.SS='P' AND RelID=2 AND G231 IN(SELECT GID FROM SGM WHERE  SID=231 AND (COALESCE(SCC,'') LIKE '%T%'))) STK ON STK.PID=TSTF.ID AND ",
        "STK.CID=TSTD.BatchID INNER JOIN (SELECT TSTF.ID,GstDT,TrxDT,(CASE WHEN TSTF.G2 IN(83,84,88,89) THEN 1 ELSE 0 END)  AS IsDP,GstRef,0 as IsIM FROM TSTF WHERE ID IN(SELECT TSTFID FROM TSTP ",
        " WHERE G231 IN(SELECT GID FROM SGM WHERE  SID=231 AND (COALESCE(SCC,'') LIKE '%T%'))) AND G2<>49 ",
        ") TXDT ON TXDT.ID=TSTF.ID  LEFT JOIN SGM OG ON OG.GID=TSTF.OGID LEFT JOIN (SELECT DrGL,CrGL,TSTFID FROM TSTP WHERE G231=23101) P ON P.TSTFID=TSTF.ID LEFT JOIN SGM S18 ON S18.GID=P.DrGL ",
        "LEFT JOIN SGM S19 ON S19.GID=P.CrGL CROSS APPLY(SELECT TSTS.SNo +', ' FROM TSTS WHERE TSTS.TSTDID>0 AND TSTS.CSSID=0 AND TSTS.TSTDID=TSTD.ID FOR XML PATH('')) SN(SNo) LEFT JOIN (SELECT ",
        "DocNo,AccID,InstNo,OXAmt,LXAmt,GLID,PDDT,ER,InputDT FROM AOF WHERE TrxSeq=0) A ON A.DocNo=TSTF.ID AND A.AccID=TSTF.AcctID AND A.InstNo=TSTF.InstNo LEFT JOIN (SELECT DocNo,AccID,InstNo,SUM(OAmt) AS ",
        "OXAmt,SUM(LXAmt) AS LXAmt,MAX(CASE WHEN TrxSeq>0 THEN DocDT ELSE NULL END) AS LastARAP_Date FROM AOF WHERE DocDT<='31 Dec 2025' GROUP BY DocNo,AccID,InstNo) B ON B.DocNo=TSTF.ID AND ",
        "B.AccID=TSTF.AcctID AND B.InstNo=TSTF.InstNo LEFT JOIN vwAML SAL ON SAL.ID=CMF.AMLID LEFT JOIN SGM S15 ON A.GLID=S15.GID LEFT JOIN (SELECT INF.XDocID,SGM.[Desc] FROM INF INNER JOIN SGM ON ",
        " INF.G310=SGM.GID INNER JOIN (SELECT MAX(ID) As [ID],XDocID FROM INF WHERE INF.SrcTable='TSTF' AND INF.SS='S' GROUP BY XDocID) I ON I.ID=INF.ID) S ON S.XDocID=TSTF.ID LEFT JOIN (SELECT ",
        "S2.GID As [CID],(CASE WHEN LEN(ISNULL(R.Route,''))>0 THEN LEFT(ISNULL(R.Route,''), LEN(ISNULL(R.Route,''))-1) ELSE '' END) As [Route],(CASE WHEN LEN(ISNULL(V.RouteAbbrev,''))>0 THEN  ",
        "LEFT(ISNULL(V.RouteAbbrev,''),LEN(ISNULL(V.RouteAbbrev,''))-1) ELSE '' END) As [RouteAbbrev],S2.[Desc] As [Zone],S2.Abbrev As [ZoneAbbrev],S2.UGC As [ZoneUGC],S3.[Desc] As ",
        "[ZoneState],S3.Abbrev As [ZoneStateAbbrev] FROM SGM S2  LEFT JOIN (SELECT GID,[Desc],Abbrev FROM SGM WHERE SID=109) S3 ON S3.GID=S2.Val CROSS APPLY (SELECT S1.[Desc]+', ' FROM MRL INNER JOIN ",
        "SGM S1 ON S1.GID=MRL.PID WHERE MRL.RelID=271 AND MRL.CID=S2.GID FOR XML PATH('')) R(Route) CROSS APPLY (SELECT S1.[Abbrev]+', ' FROM MRL INNER JOIN SGM S1 ON S1.GID=MRL.PID WHERE MRL.RelID=",
        "271 AND MRL.CID=S2.GID FOR XML PATH('')) V(RouteAbbrev) WHERE S2.SID=270) Z ON Z.CID=TSTF.LUAID CROSS APPLY(SELECT AMF.Name +', ' FROM TSTT INNER JOIN AMF ON TSTT.AMFID=AMF.ID WHERE ",
        "TSTT.TSTFID=TSTF.ID FOR XML PATH('')) Tech(TechName) WHERE (((((TSTF.SS IN('A','P','C')) AND ISNULL(TSTD.SCC,'')='') AND ",
        " (S13.SCC LIKE '%P%' OR (S13.GID=80 AND  (COALESCE(S3.SCC,'') LIKE '%E%' AND COALESCE(S3.SCC,'') LIKE '%D%' AND COALESCE(S3.SCC,'') LIKE '%S%')))) AND S13.GID ",
        " NOT IN(73,78)) AND ISNULL(TSTF.GstRevG231,0)=0) AND ((TXDT.IsIM=0 AND ISNULL(TSTD.GstXID,0)=0) OR (TXDT.IsIM=1 AND TSTD.GstXID>0)) ",
        " ) T WHERE @TrxDT @LastSync Status='Posted' AND Z_OAmt<>0 AND DocType  IN('Invoice','Debit Note','Credit Note','Cash Sales','Cash Debit','Cash Credit') AND TrxDT>='2025-07-01' "," ORDER BY InputDT, ID, DocDT,Doc_No, Z_ID "].join(' ');          
//exclude expense note unless special request
        
var pbsbclient = [
        "SELECT @LIMIT 0 as ID, (case when isnull(a.ogid,0)=0 and isnull(h.ogid,0)<>0 then (case when len(hg.description)=4 then hg.description else upper(left(hg.description,2)) end) when ISNULL(o.id,0)=0 or o.id=1 or o.parent is null then 'PBSB' else (case when len(o.description)=4 then o.description else upper(left(o.description,2)) end) end) AS OGCode,",
        "(case when isnull(a.ogid,0)=0 and isnull(h.ogid,0)<>0 then hg.description when ISNULL(o.id,0)=0 then 'Perinsuran (Brokar) Sdn. Bhd.' else o.description end) AS OGName,",
        "a.Name, a.Abbrev, g35.[desc] as Incorporation, '' as IC_Reg_ID, cast(NULL as date) as C_Ment_Since,",
        "(case when a.G30=301 THEN 'Customer' when a.G30=302 THEN 'Insurer' when a.G30=303 THEN 'Introducer' when a.G30=304 THEN 'Salesperson' when a.G30=305 THEN 'Insurer' when a.G30=306 THEN 'Adjuster' when a.G30=307 THEN 'Reinsurer' when a.G30=308 THEN 'Cedant' when a.G30=309 THEN 'Office User' when a.G30=310 THEN 'Supplier' when a.G30=316 THEN 'Co-Broker' else 'General' end) as Type,",
        "a.DOB as Birthdate, g31.[desc] as Class, cast(NULL as varchar) as Sales, g32.[desc] as Industry, g33.[desc] as Nature, (case when len(isnull(a.add1,''))=0 then 'No address' else a.Add1 end) as Add1, a.Add2, a.Add3, '' as Post_Code, a.Add4 as State, 'Malaysia' as Country,",
        "LTRIM(RTRIM((case when patindex('%@%',a.Email)=0 THEN 'noemail@noemail.noemail' WHEN patindex('%,%',replace(a.Email,'/',','))>0 then substring(a.Email,1,patindex('%,%',replace(a.Email,'/',','))-1) when RTRIM(ISNULL(a.Email,''))='' THEN 'noemail@noemail.noemail' else rtrim(a.Email) end))) as Email, ISNULL(a.Phone,'') as Office_Phone, '' as House_Phone, ISNULL(a.PhoneMob,'') as Mobile_Phone, ISNULL(a.Fax,'') AS Fax,",
        "a.Contact, '' as Position, '' as Gender, NULL as Salutation, '' as Tax_No, ISNULL(replace(RTRIM(a.CurrCode),'RM','MYR'),'MYR') as Currency_Code, a.AccNo, a.BActNo1 as BankAcc1, a.BActNo2 as BankAcc2, NULL as Credit_Terms, '' as Notes",
        "from amf a LEFT JOIN OGM o on o.ID=a.OGID LEFT JOIN SGM g31 on g31.gid=a.G31 LEFT JOIN SGM g32 on g32.gid=a.G32 LEFT JOIN SGM g33 on g33.gid=a.G33",
        "LEFT JOIN SGM g35 on g35.gid=a.G35 LEFT JOIN amf h on h.accno=a.handler LEFT JOIN ogm hg on hg.ID=h.OGID",
        "WHERE @LastSync (a.G30 IN(302,303,316) OR (a.G30 IN(301) AND a.accno in(select accno from AOF where docdt>='2025-07-01' and acctype='C' and trxseq=0 and OBrDisc<>0) and a.G31=312))"
].join(' ');


var pbsbtrade = [
        "SELECT @LIMIT 0 as ID, a.InputDT, r.DocDT as TrxDT, 'un' AS Z_UOM,",
        "(case when isnull(r.ogid,0)=0 or o.id=1 or o.parent is null then 'PBSB' when len(o.description)=4 then o.description else upper(left(o.description,2)) end) AS OGCode,",
        "(case when isnull(r.ogid,0)=0 or o.id=1 or o.parent is null then 'Perinsuran (Brokar) Sdn. Bhd.' else o.description end) AS OGName,",
        "(case when r.doctype='B' AND r.OTGB>0 then 'Invoice' when r.OTGB<0 then 'Credit Note' else 'Debit Note' end) as Doc_Type,",
        "r.udno as Doc_No, ISNULL(r.RefNo,r.dcnno) as RefNo, (case when r.doctype='B' then NULL else x.udno end) as XDoc_No, u.UWCode as AccNo, u.UWName as Name, r.DocDT, r.Narration, '' as Handler, 0 as GST_Inclusive, REPLACE(RTRIM(r.CCPrm),'RM','MYR') as Currency, r.ERPrm AS ex_rate, r.OTGB  as TotalAmount, '0D' as Terms, '' as Order_No, '' as Set_Title, r.EndEffDate as StartDT, r.EndExpDate as EndDT, datediff(month,r.EndEffDate,r.EndExpDate) as Period,",
        "'Bill Items' as Trx_Type, 'BROKERAGE ' + cast(u.GB as varchar) +'%'+(case when len(isnull(u.polno,'')+isnull(m.coverno,''))>0 then ' FOR ' + isnull(u.polno,'')+(case when len(u.polno+m.coverno)>0 then '/' else '' end)+isnull(m.coverno,'') else '' end) as Trx_Desc, NULL as Item, 1 as Qty, r.OTGB as Price, r.OTGB as Amount, 'TAXEXMPT' as Tax1, 0 as Tax1_Rate, 0 as Tax1_Amount, '' as Tax1_GL",
        "FROM rnf r INNER JOIN UDF u on u.docno=r.docno INNER JOIN AOF a ON a.docno=r.docno and a.accno=u.uwcode LEFT JOIN MDF m on m.docno=r.docno LEFT JOIN OGM o on o.ID=r.OGID",
        "left join rnf x on x.docno=((r.docno/100)*100)",
        "where @LastSync r.SS='P' AND r.TS='A' AND a.TrxSeq=0 AND u.leader=1 and len(r.udno)>0 and r.OTGB<>0 AND r.docdt>='2025-07-01' and r.doctype in ('B','A','E') ORDER BY a.InputDT, r.docdt"
].join(' ');

var pbsbbdtrade = [
        "SELECT @LIMIT 0 as ID, a.InputDT, r.DocDT as TrxDT, 'un' AS Z_UOM,",
        "(case when isnull(r.ogid,0)=0 or o.id=1 or o.parent is null then 'PBSB' when len(o.description)=4 then o.description else upper(left(o.description,2)) end) AS OGCode,",
        "(case when isnull(r.ogid,0)=0 or o.id=1 or o.parent is null then 'Perinsuran (Brokar) Sdn. Bhd.' else o.description end) AS OGName,",
        "(case when r.doctype='B' AND r.OBrDisc>0 then 'Self-Billed Invoice' when r.OBrDisc<0 then 'Self-Billed Credit Note' else 'Self-Billed Debit Note' end) as Doc_Type,",
        "'BD'+r.udno as Doc_No, ISNULL(r.RefNo,r.dcnno) as RefNo, (case when r.doctype='B' then NULL else 'BD'+x.udno end) as XDoc_No, r.ClientNo as AccNo, r.ClientName as Name, r.DocDT, r.Narration, '' as Handler, 0 as GST_Inclusive, REPLACE(RTRIM(r.CCPrm),'RM','MYR') as Currency, r.ERPrm AS ex_rate, r.OBrDisc  as TotalAmount, '0D' as Terms, '' as Order_No, '' as Set_Title, r.EndEffDate as StartDT, r.EndExpDate as EndDT, datediff(month,r.EndEffDate,r.EndExpDate) as Period,",
        "'Bill Items' as Trx_Type, 'DISCOUNT ' + cast(r.BrDisc as varchar) +'%'+(case when len(isnull(u.polno,'')+isnull(m.coverno,''))>0 then ' FOR ' + isnull(u.polno,'')+(case when len(u.polno+m.coverno)>0 then '/' else '' end)+isnull(m.coverno,'') else '' end) as Trx_Desc, NULL as Item, 1 as Qty, r.OBrDisc as Price, r.OBrDisc as Amount, 'TAXEXMPT' as Tax1, 0 as Tax1_Rate, 0 as Tax1_Amount, '' as Tax1_GL",
        "FROM rnf r INNER JOIN AMF f ON f.AccNo=r.ClientNo INNER JOIN UDF u on u.docno=r.docno INNER JOIN AOF a ON a.docno=r.docno and a.accno=r.clientno LEFT JOIN MDF m on m.docno=r.docno LEFT JOIN OGM o on o.ID=r.OGID",
        "left join rnf x on x.docno=((r.docno/100)*100)",
        "where @LastSync r.SS='P' AND r.TS='A' AND a.TrxSeq=0 AND u.leader=1 and len(r.udno)>0 and r.OBrDisc<>0 AND f.G31=312 AND r.docdt>='2025-07-01' and r.doctype in ('B','A','E') ORDER BY a.InputDT, r.docdt"
].join(' ');

var pbsbsbtrade = [
        "SELECT @LIMIT 0 as ID, a.InputDT, r.DocDT as TrxDT, 'un' AS Z_UOM,",
        "(case when isnull(r.ogid,0)=0 or o.id=1 or o.parent is null then 'PBSB' when len(o.description)=4 then o.description else upper(left(o.description,2)) end) AS OGCode,",
        "(case when isnull(r.ogid,0)=0 or o.id=1 or o.parent is null then 'Perinsuran (Brokar) Sdn. Bhd.' else o.description end) AS OGName,",
        "(case when r.doctype='B' AND sb.OFee>0 then 'Self-Billed Invoice' when sb.OFee<0 then 'Self-Billed Credit Note' else 'Self-Billed Debit Note' end) as Doc_Type,",
        "'SB'+r.udno as Doc_No, ISNULL(r.RefNo,r.dcnno) as RefNo, (case when r.doctype='B' then NULL else 'SB'+x.udno end) as XDoc_No, sb.SBCode as AccNo, sb.SBName as Name, r.DocDT, r.Narration, '' as Handler, 0 as GST_Inclusive, REPLACE(RTRIM(r.CCPrm),'RM','MYR') as Currency, r.ERPrm AS ex_rate, sb.OFee  as TotalAmount, '0D' as Terms, '' as Order_No, '' as Set_Title, r.EndEffDate as StartDT, r.EndExpDate as EndDT, datediff(month,r.EndEffDate,r.EndExpDate) as Period,",
        "'Bill Items' as Trx_Type, 'FEES ' + cast(sb.Fee as varchar) +'%'+(case when len(isnull(u.polno,'')+isnull(m.coverno,''))>0 then ' FOR ' + isnull(u.polno,'')+(case when len(u.polno+m.coverno)>0 then '/' else '' end)+isnull(m.coverno,'') else '' end) as Trx_Desc, NULL as Item, 1 as Qty, sb.OFee as Price, sb.OFee as Amount, 'TAXEXMPT' as Tax1, 0 as Tax1_Rate, 0 as Tax1_Amount, '' as Tax1_GL",
        "FROM rnf r INNER JOIN UDF u on u.docno=r.docno INNER JOIN IDF sb ON sb.docno=r.docno INNER JOIN AOF a ON a.docno=r.docno AND a.accno=sb.SBCode LEFT JOIN MDF m on m.docno=r.docno LEFT JOIN OGM o on o.ID=r.OGID",
        "left join rnf x on x.docno=((r.docno/100)*100)",
        "where @LastSync r.SS='P' AND r.TS='A' AND a.TrxSeq=0 AND u.leader=1 and len(r.udno)>0 and sb.OFee<>0 AND r.docdt>='2025-07-01' and r.doctype in ('B','A','E') ORDER BY a.InputDT, r.docdt"
].join(' ');


var afrclient = [
        "SELECT @LIMIT 0 as ID, o.code AS OGCode, o.description AS OGName,",
        "(CASE WHEN LEN(RTRIM(a.Name))=0 THEN 'NOName' ELSE a.Name END) as Name, a.Abbrev, g35.[desc] as Incorporation, '' as IC_Reg_ID, cast(NULL as date) as C_Ment_Since,",
        "(case when a.G30=301 THEN 'Customer' when a.G30=302 THEN 'Insurer' when a.G30=303 THEN 'Introducer' when a.G30=304 THEN 'Salesperson' when a.G30=305 THEN 'Insurer' when a.G30=306 THEN 'Adjuster' when a.G30=307 THEN 'Reinsurer' when a.G30=308 THEN 'Cedant' when a.G30=309 THEN 'Office User' when a.G30=310 THEN 'Supplier' when a.G30=316 THEN 'Co-Broker' else 'General' end) as Type,",
        "a.DOB as Birthdate, g31.[desc] as Class, cast(NULL as varchar) as Sales, NULL as Industry, g33.[desc] as Nature, (case when len(isnull(a.add1,''))=0 then 'No address' else a.Add1 end) as Add1, a.Add2, a.Add3, '' as Post_Code, a.Add4 as State, ISNULL(g8.[desc],'Malaysia') as Country,",
        "LTRIM(RTRIM((case when patindex('%@%',a.Email)=0 THEN 'noemail@noemail.noemail' WHEN patindex('%,%',replace(a.Email,'/',','))>0 then substring(a.Email,1,patindex('%,%',replace(a.Email,'/',','))-1) when RTRIM(ISNULL(a.Email,''))='' THEN 'noemail@noemail.noemail' else rtrim(replace(a.Email,' ','')) end))) as Email, ISNULL(a.Phone,'') as Office_Phone, '' as House_Phone, ISNULL(a.PhoneMob,'') as Mobile_Phone, ISNULL(a.Fax,'') AS Fax,",
        "a.Contact, '' as Position, '' as Gender, NULL as Salutation, a.TaxNo as Tax_No, ISNULL(replace(RTRIM(a.CurrCode),'RM','MYR'),'MYR') as Currency_Code, a.AccNo, a.BActNo1 as BankAcc1, a.BActNo2 as BankAcc2, NULL as Credit_Terms, '' as Notes",
        "from amf a LEFT JOIN (select id, description, 'HQ'+(case when patindex('%(%',description)>0 then substring(description,patindex('%(%',description)+1,1) else '' END) as code FROM OGM WHERE ID=1) o on o.ID=(CASE WHEN a.OGID>0 THEN 1 ELSE 1 END) LEFT JOIN SGM g31 on g31.gid=a.G31 LEFT JOIN SGM g33 on g33.gid=a.G33",
        "LEFT JOIN SGM g35 on g35.gid=a.G35 LEFT JOIN SGM g8 on g8.gid=a.Country LEFT JOIN amf h on h.accno=a.handler LEFT JOIN ogm hg on hg.ID=h.OGID",
        "WHERE @LastSync a.G30 IN(303,307) AND NOT a.accno like 'X%'"
].join(' ');
//"WHERE @LastSync a.G30 IN(303,307) AND NOT a.accno like 'X%' AND a.accno not in('TBA')"
//        "LEFT JOIN SGM g32 on g32.gid=a.G32 WHERE @LastSync a.G30 IN(303,307) AND a.accno not in(select ClaimAct from amf where ClaimAct is not null) AND a.accno not in('TBA')"

var afrtrade = [
        "SELECT @LIMIT 0 as ID, a.InputDT, r.DocDT as TrxDT, 'un' AS Z_UOM, o.code AS OGCode, o.description AS OGName,",
        "(case when r.doctype='I' AND (u.ORGB+u.OComm)>0 then 'Invoice' when (u.ORGB+u.OComm)<0 then 'Credit Note' else 'Debit Note' end) as Doc_Type,",
        "d.UDNo as Doc_No, ISNULL(r.RefNo,r.dcnno) as RefNo, d.XUDNo as XDoc_No, u.UWCode as AccNo, u.UWName as Name, r.DocDT, r.Narration, '' as Handler, 0 as GST_Inclusive, REPLACE(RTRIM(r.CCPrm),'RM','MYR') as Currency, r.ERPrm AS ex_rate, (u.ORGB+u.OComm)  as TotalAmount, '0D' as Terms, '' as Order_No, '' as Set_Title, r.EndEffDate as StartDT, r.EndExpDate as EndDT, datediff(month,r.EndEffDate,r.EndExpDate) as Period,",
        "'Bill Items' as Trx_Type, UPPER(r.ClientName) + ' - ' + UPPER(i.[Desc]) +(case when len(isnull(u.polno,''))>0 then ' - ' + isnull(u.polno,'') else '' end) as Trx_Desc, NULL as Item, 1 as Qty, (u.ORGB+u.OComm) as Price, (u.ORGB+u.OComm) as Amount, 'TAXEXMPT' as Tax1, 0 as Tax1_Rate, 0 as Tax1_Amount, '' as Tax1_GL",
        "FROM rei r INNER JOIN RUF c ON c.docno=r.docno INNER JOIN RRF u on u.docno=r.docno AND u.runo=c.uwno INNER JOIN AOF a ON a.docno=r.docno and a.accno=u.uwcode INNER JOIN ICM i ON i.CC = r.InsClass ",
        "LEFT JOIN (select id, description, 'HQ'+(case when patindex('%(%',description)>0 then substring(description,patindex('%(%',description)+1,1) else '' END) as code FROM OGM WHERE ID=1) o on o.ID=(CASE WHEN a.OGID>0 THEN 1 ELSE 1 END)",
        "left join rei x on x.docno=((r.docno/100)*100)",
        "outer apply(select ",
        "(case when patindex('%/%',r.dcnno)>0 then substring(r.dcnno,1,patindex('%/%',r.dcnno)-1) else '' END)+right(r.udno,8)+'-'+c.uwcode+'-'+u.uwcode as UDNo,",
        "(case when r.doctype='I' then NULL else (case when patindex('%/%',x.dcnno)>0 then substring(x.dcnno,1,patindex('%/%',x.dcnno)-1) else '' END)+right(x.udno,8)+'-'+c.uwcode+'-'+u.uwcode end) as XUDNo",
        ") d",
        "where @LastSync r.SS='P' AND r.TS='A' AND a.TrxSeq=0 AND a.InstNo=0 and len(r.udno)>0 and (u.ORGB+u.OComm)<>0 AND r.docdt>='2025-07-01' and r.doctype in ('I','A','E') ORDER BY a.InputDT, r.docdt"
].join(' ');

var afrsbtrade = [
        "SELECT @LIMIT 0 as ID, a.InputDT, r.DocDT as TrxDT, 'un' AS Z_UOM, o.code AS OGCode, o.description AS OGName,",
        "(case when r.doctype='I' AND sb.OFee>0 then 'Self-Billed Invoice' when sb.OFee<0 then 'Self-Billed Credit Note' else 'Self-Billed Debit Note' end) as Doc_Type,",
        "d.UDNo as Doc_No, ISNULL(r.RefNo,r.dcnno) as RefNo, d.XUDNo as XDoc_No, sb.SBCode as AccNo, sb.SBName as Name, r.DocDT, r.Narration, '' as Handler, 0 as GST_Inclusive, REPLACE(RTRIM(r.CCPrm),'RM','MYR') as Currency, r.ERPrm AS ex_rate, sb.OFee  as TotalAmount, '0D' as Terms, '' as Order_No, '' as Set_Title, r.EndEffDate as StartDT, r.EndExpDate as EndDT, datediff(month,r.EndEffDate,r.EndExpDate) as Period,",
        "'Bill Items' as Trx_Type, UPPER(r.ClientName) + ' - ' + UPPER(i.[Desc]) as Trx_Desc, NULL as Item, 1 as Qty, sb.OFee as Price, sb.OFee as Amount, 'TAXEXMPT' as Tax1, 0 as Tax1_Rate, 0 as Tax1_Amount, '' as Tax1_GL",
        "FROM rei r INNER JOIN (SELECT DocNo, SBCode, SBName, MAX(FEE) AS Fee, SUM(OFee) AS OFee FROM RIDF GROUP BY DocNo, SBCode, SBName HAVING SUM(OFee)<>0) sb ON sb.docno=r.docno INNER JOIN AOF a ON a.docno=r.docno AND a.accno=sb.SBCode INNER JOIN ICM i ON i.CC = r.InsClass ",
        "LEFT JOIN (select id, description, 'HQ'+(case when patindex('%(%',description)>0 then substring(description,patindex('%(%',description)+1,1) else '' END) as code FROM OGM WHERE ID=1) o on o.ID=(CASE WHEN a.OGID>0 THEN 1 ELSE 1 END)",
        "left join rei x on x.docno=((r.docno/100)*100)",
        "outer apply(select r.udno+'-'+sb.SBCode as UDNo, (case when r.doctype='I' then NULL else x.udno+'-'+sb.SBCode end) as XUDNo) d",
        "where @LastSync r.SS='P' AND r.TS='A' AND a.TrxSeq=0 AND a.InstNo=0 and len(r.udno)>0 and sb.OFee<>0 AND r.docdt>='2025-07-01' and r.doctype in ('I','A','E') AND NOT (sb.SBName like '%Howden Takaful%' OR sb.SBName like '%Tradewind%' OR sb.SBName like '%SP&G%') ORDER BY a.InputDT, r.docdt"
].join(' ');
//        "FROM rei r INNER JOIN (SELECT DocNo, SBCode, SBName, MAX(FEE) AS Fee, SUM(OFee) AS OFee FROM RIDF WHERE SBCode<>'TBA' GROUP BY DocNo, SBCode, SBName) sb ON sb.docno=r.docno INNER JOIN AOF a ON a.docno=r.docno AND a.accno=sb.SBCode",
//exclude [Howden Takaful, Tradewind] as confirmed by customer



var ankclient = [
        "SELECT @LIMIT 0 as ID, (case when isnull(a.ogid,0)=0 and isnull(h.ogid,0)<>0 then (case when hg.parent=27 then substring(hg.name,1,1) else hg.UGC end) when ISNULL(o.id,0)=0 then 'ANIKA' when o.id=1 then 'ANIKA' when o.parent is null then 'ANIKA' else (case when o.parent=27 then substring(o.name,1,1) else o.UGC end) end) AS OGCode,",
        "(case when isnull(a.ogid,0)=0 and isnull(h.ogid,0)<>0 then hg.description when ISNULL(o.id,0)=0 then 'ANIKA INSURANCE BROKERS SDN BHD' else o.description end) AS OGName,",
        "a.Name, a.Abbrev, g35.[desc] as Incorporation, '' as IC_Reg_ID, cast(NULL as date) as C_Ment_Since,",
        "(case when a.G30=301 THEN 'Customer' when a.G30=302 THEN 'Insurer' when a.G30=303 THEN 'Introducer' when a.G30=304 THEN 'Salesperson' when a.G30=305 THEN 'Insurer' when a.G30=306 THEN 'Adjuster' when a.G30=307 THEN 'Reinsurer' when a.G30=308 THEN 'Cedant' when a.G30=309 THEN 'Office User' when a.G30=310 THEN 'Supplier' when a.G30=316 THEN 'Co-Broker' else 'General' end) as Type,",
        "a.DOB as Birthdate, g31.[desc] as Class, cast(NULL as varchar) as Sales, g32.[desc] as Industry, g33.[desc] as Nature, (case when len(isnull(a.add1,''))=0 then 'No address' else a.Add1 end) as Add1, a.Add2, a.Add3, '' as Post_Code, a.Add4 as State, ISNULL(g8.[desc],'Malaysia') as Country,",
        "LTRIM(RTRIM((case when patindex('%@%',a.Email)=0 THEN 'noemail@noemail.noemail' WHEN patindex('%,%',replace(a.Email,'/',','))>0 then substring(a.Email,1,patindex('%,%',replace(a.Email,'/',','))-1) when RTRIM(ISNULL(a.Email,''))='' THEN 'noemail@noemail.noemail' else rtrim(a.Email) end))) as Email, ISNULL(a.Phone,'') as Office_Phone, '' as House_Phone, ISNULL(a.PhoneMob,'') as Mobile_Phone, ISNULL(a.Fax,'') AS Fax,",
        "a.Contact, '' as Position, '' as Gender, NULL as Salutation, a.TaxNo as Tax_No, ISNULL(replace(RTRIM(a.CurrCode),'RM','MYR'),'MYR') as Currency_Code, a.AccNo, a.BActNo1 as BankAcc1, a.BActNo2 as BankAcc2, NULL as Credit_Terms, '' as Notes",
        "from amf a LEFT JOIN OGM o on o.ID=a.OGID LEFT JOIN SGM g31 on g31.gid=a.G31 LEFT JOIN SGM g32 on g32.gid=a.G32 LEFT JOIN SGM g33 on g33.gid=a.G33",
        "LEFT JOIN SGM g35 on g35.gid=a.G35 LEFT JOIN SGM g8 on g8.gid=a.Country LEFT JOIN amf h on h.accno=a.handler LEFT JOIN ogm hg on hg.ID=h.OGID",
        "WHERE @LastSync (a.G30 IN(302,303,316) OR (a.G30 IN(301) AND (a.accno in(select accno from AOF where docdt>='2025-08-01' and acctype='C' and trxseq=0 and OBrDisc<>0) and a.G31=312 or a.accno in(select accno from AOF where docdt>='2025-08-01' and acctype='C' and trxseq=0 and OOTH<>0))))"
].join(' ');


var anktrade = [
        "SELECT @LIMIT 0 as ID, a.InputDT, r.DocDT as TrxDT, 'un' AS Z_UOM,",
        "(case when isnull(r.ogid,0)=0 then 'ANIKA' when o.id=1 then 'ANIKA' when o.parent is null then o.UGC WHEN o.parent=1 THEN o.UGC else left(o.name,1) end) AS OGCode,",
        "(case when isnull(r.ogid,0)=0 then 'ANIKA INSURANCE BROKERS SDN BHD' else o.name end) AS OGName,",
        "(case when r.doctype='B' AND r.OTGB>0 then 'Invoice' when r.OTGB<0 then 'Credit Note' else 'Debit Note' end) as Doc_Type,",
        "r.udno as Doc_No, ISNULL(r.RefNo,r.dcnno) as RefNo, (case when r.doctype='B' then NULL else x.udno end) as XDoc_No, u.UWCode as AccNo, u.UWName as Name, r.DocDT, r.Narration, '' as Handler, 0 as GST_Inclusive, REPLACE(RTRIM(r.CCPrm),'RM','MYR') as Currency, r.ERPrm AS ex_rate, r.OTGB  as TotalAmount, '0D' as Terms, '' as Order_No, '' as Set_Title, r.EndEffDate as StartDT, r.EndExpDate as EndDT, datediff(month,r.EndEffDate,r.EndExpDate) as Period,",
        "'Bill Items' as Trx_Type, 'BROKERAGE ' + cast(u.GB as varchar) +'%'+(case when len(isnull(u.polno,'')+isnull(m.coverno,''))>0 then ' FOR ' + isnull(u.polno,'')+(case when len(u.polno+m.coverno)>0 then '/' else '' end)+isnull(m.coverno,'') else '' end) as Trx_Desc, NULL as Item, 1 as Qty, r.OTGB as Price, r.OTGB as Amount, 'TAXEXMPT' as Tax1, 0 as Tax1_Rate, 0 as Tax1_Amount, '' as Tax1_GL",
        "FROM rnf r INNER JOIN UDF u on u.docno=r.docno INNER JOIN AOF a ON a.docno=r.docno and a.accno=u.uwcode LEFT JOIN MDF m on m.docno=r.docno LEFT JOIN OGM o on o.ID=r.OGID",
        "left join rnf x on x.docno=((r.docno/100)*100)",
        "where @LastSync r.SS='P' AND r.TS='A' AND a.TrxSeq=0 AND u.leader=1 and len(r.udno)>0 and r.OTGB<>0 AND r.docdt>='2025-08-01' and r.doctype in ('B','A','E') ORDER BY a.InputDT, r.docdt"
].join(' ');

var ankbktrade = [
        "SELECT @LIMIT 0 as ID, a.InputDT, r.DocDT as TrxDT, 'un' AS Z_UOM,",
        "(case when isnull(r.ogid,0)=0 then 'ANIKA' when o.id=1 then 'ANIKA' when o.parent is null then o.UGC WHEN o.parent=1 THEN o.UGC else left(o.name,1) end) AS OGCode,",
        "(case when isnull(r.ogid,0)=0 then 'ANIKA INSURANCE BROKERS SDN BHD' else o.description end) AS OGName,",
        "(case when r.doctype='B' AND (r.OOTH-r.OBrDisc)>0 then 'Invoice' when (r.OOTH-r.OBrDisc)<0 then 'Credit Note' else 'Debit Note' end) as Doc_Type,",
        "'BK'+r.udno as Doc_No, ISNULL(r.RefNo,r.dcnno) as RefNo, (case when r.doctype='B' then NULL else 'BK'+x.udno end) as XDoc_No, r.ClientNo as AccNo, r.ClientName as Name, r.DocDT, r.Narration, '' as Handler, 0 as GST_Inclusive, REPLACE(RTRIM(r.CCPrm),'RM','MYR') as Currency, r.ERPrm AS ex_rate, (r.OOTH-r.OBrDisc+r.OSTax2)  as TotalAmount, '0D' as Terms, '' as Order_No, '' as Set_Title, r.EndEffDate as StartDT, r.EndExpDate as EndDT, datediff(month,r.EndEffDate,r.EndExpDate) as Period,",
        "'Bill Items' as Trx_Type, ISNULL(s.[Desc],'CHARGES')+(case when len(isnull(u.polno,'')+isnull(m.coverno,''))>0 then ' FOR ' + isnull(u.polno,'')+(case when len(u.polno+m.coverno)>0 then '/' else '' end)+isnull(m.coverno,'') else '' end) as Trx_Desc, NULL as Item, 1 as Qty, (r.OOTH-r.OBrDisc) as Price, (r.OOTH-r.OBrDisc) as Amount, (CASE WHEN r.OSTax2<>0 THEN 'ST8' ELSE NULL END) as Tax1, (CASE WHEN r.OSTax2<>0 THEN 8 ELSE 0 END) as Tax1_Rate, ISNULL(r.OSTax2,0) as Tax1_Amount, '' as Tax1_GL",
        "FROM rnf r INNER JOIN AMF f ON f.AccNo=r.ClientNo INNER JOIN UDF u on u.docno=r.docno INNER JOIN AOF a ON a.docno=r.docno and a.accno=r.clientno LEFT JOIN MDF m on m.docno=r.docno LEFT JOIN OGM o on o.ID=r.OGID",
        "left join rnf x on x.docno=((r.docno/100)*100) LEFT JOIN SGM s ON s.GID=r.G91 LEFT JOIN SGM t ON t.GID=r.G91",
        "where @LastSync r.SS='P' AND r.TS='A' AND a.TrxSeq=0 AND u.leader=1 and len(r.udno)>0 and r.OOTH<>0 AND (r.OOTH-r.OBrDisc)<>0 AND r.docdt>='2025-08-01' and r.doctype in ('B','A','E') ORDER BY a.InputDT, r.docdt"
].join(' ');


var ankbdtrade = [
        "SELECT @LIMIT 0 as ID, a.InputDT, r.DocDT as TrxDT, 'un' AS Z_UOM,",
        "(case when isnull(r.ogid,0)=0 then 'ANIKA' when o.id=1 then 'ANIKA' when o.parent is null then o.UGC WHEN o.parent=1 THEN o.UGC else left(o.name,1) end) AS OGCode,",
        "(case when isnull(r.ogid,0)=0 then 'ANIKA INSURANCE BROKERS SDN BHD' else o.description end) AS OGName,",
        "(case when r.doctype='B' AND r.OBrDisc>0 then 'Self-Billed Invoice' when r.OBrDisc<0 then 'Self-Billed Credit Note' else 'Self-Billed Debit Note' end) as Doc_Type,",
        "'BD'+r.udno as Doc_No, ISNULL(r.RefNo,r.dcnno) as RefNo, (case when r.doctype='B' then NULL else 'BD'+x.udno end) as XDoc_No, r.ClientNo as AccNo, r.ClientName as Name, r.DocDT, r.Narration, '' as Handler, 0 as GST_Inclusive, REPLACE(RTRIM(r.CCPrm),'RM','MYR') as Currency, r.ERPrm AS ex_rate, r.OBrDisc  as TotalAmount, '0D' as Terms, '' as Order_No, '' as Set_Title, r.EndEffDate as StartDT, r.EndExpDate as EndDT, datediff(month,r.EndEffDate,r.EndExpDate) as Period,",
        "'Bill Items' as Trx_Type, 'DISCOUNT ' + cast(r.BrDisc as varchar) +'%'+(case when len(isnull(u.polno,'')+isnull(m.coverno,''))>0 then ' FOR ' + isnull(u.polno,'')+(case when len(u.polno+m.coverno)>0 then '/' else '' end)+isnull(m.coverno,'') else '' end) as Trx_Desc, NULL as Item, 1 as Qty, r.OBrDisc as Price, r.OBrDisc as Amount, 'ST8' as Tax1, 0 as Tax1_Rate, 0 as Tax1_Amount, '' as Tax1_GL",
        "FROM rnf r INNER JOIN AMF f ON f.AccNo=r.ClientNo INNER JOIN UDF u on u.docno=r.docno INNER JOIN AOF a ON a.docno=r.docno and a.accno=r.clientno LEFT JOIN MDF m on m.docno=r.docno LEFT JOIN OGM o on o.ID=r.OGID",
        "left join rnf x on x.docno=((r.docno/100)*100)",
        "where @LastSync r.SS='P' AND r.TS='A' AND a.TrxSeq=0 AND u.leader=1 and len(r.udno)>0 and r.OBrDisc<>0 and ISNULL(r.OOth,0)=0 AND f.G31=312 AND r.docdt>='2025-08-01' and r.doctype in ('B','A','E') ORDER BY a.InputDT, r.docdt"
].join(' ');


var anksbtrade = [
        "SELECT @LIMIT 0 as ID, a.InputDT, r.DocDT as TrxDT, 'un' AS Z_UOM,",
        "(case when isnull(r.ogid,0)=0 then 'ANIKA' when o.id=1 then 'ANIKA' when o.parent is null then o.UGC WHEN o.parent=1 THEN o.UGC else left(o.name,1) end) AS OGCode,",
        "(case when isnull(r.ogid,0)=0 then 'ANIKA INSURANCE BROKERS SDN BHD' else o.description end) AS OGName,",
        "(case when r.doctype='B' AND sb.OFee>0 then 'Self-Billed Invoice' when sb.OFee<0 then 'Self-Billed Credit Note' else 'Self-Billed Debit Note' end) as Doc_Type,",
        "'SB'+r.udno as Doc_No, ISNULL(r.RefNo,r.dcnno) as RefNo, (case when r.doctype='B' then NULL else 'SB'+x.udno end) as XDoc_No, sb.SBCode as AccNo, sb.SBName as Name, r.DocDT, r.Narration, '' as Handler, 0 as GST_Inclusive, REPLACE(RTRIM(r.CCPrm),'RM','MYR') as Currency, r.ERPrm AS ex_rate, sb.OFee  as TotalAmount, '0D' as Terms, '' as Order_No, '' as Set_Title, r.EndEffDate as StartDT, r.EndExpDate as EndDT, datediff(month,r.EndEffDate,r.EndExpDate) as Period,",
        "'Bill Items' as Trx_Type, 'FEES ' + cast(sb.Fee as varchar) +'%'+(case when len(isnull(u.polno,'')+isnull(m.coverno,''))>0 then ' FOR ' + isnull(u.polno,'')+(case when len(u.polno+m.coverno)>0 then '/' else '' end)+isnull(m.coverno,'') else '' end) as Trx_Desc, NULL as Item, 1 as Qty, sb.OFee as Price, sb.OFee as Amount, 'ST8' as Tax1, 0 as Tax1_Rate, 0 as Tax1_Amount, '' as Tax1_GL",
        "FROM rnf r INNER JOIN UDF u on u.docno=r.docno INNER JOIN IDF sb ON sb.docno=r.docno INNER JOIN AOF a ON a.docno=r.docno and a.accno=sb.SBCode LEFT JOIN MDF m on m.docno=r.docno LEFT JOIN OGM o on o.ID=r.OGID",
        "left join rnf x on x.docno=((r.docno/100)*100)",
        "where @LastSync r.SS='P' AND r.TS='A' AND a.TrxSeq=0 AND u.leader=1 and len(r.udno)>0 and sb.OFee<>0 AND r.docdt>='2025-08-01' and r.doctype in ('B','A','E') ORDER BY a.InputDT, r.docdt"
].join(' ');


var Sqlqueries = {
	contact: {k: 'AMF.AccNo', q: contactsqlquery},
	item: {k: 'PDS.Code', q: itemsqlquery},
	subcontact: {k: 'AML.ID', q: subcontactsqlquery},
	trade: {k: 'UDNo', dt:'InputDT', q: tradesqlquery},
	sibplclient: {k: 'AMF.AccNo', q: sibplclient},
	sibpltrade: {k: 'UDNo', dt:'InputDT', q: sibpltrade},
        sibclient: {k: 'a.AccNo', q: sibclient},
        sibtrade: {k: 'r.UDNo', dt:'a.InputDT', q: sibtrade},
        sibbdtrade: {k: "('BD'+r.UDNo)", dt:'a.InputDT', q: sibbdtrade},
        sibsbtrade: {k: "('SB'+r.UDNo)", dt:'a.InputDT', q: sibsbtrade},
        sibcbtrade: {k: "('CB'+r.UDNo)", dt:'a.InputDT', q: sibcbtrade},
        pbsbclient: {k: 'a.AccNo', q: pbsbclient},
        pbsbtrade: {k: 'r.UDNo', dt:'a.InputDT', q: pbsbtrade},
        pbsbbdtrade: {k: "('BD'+r.UDNo)", dt:'a.InputDT', q: pbsbbdtrade},
        pbsbsbtrade: {k: "('SB'+r.UDNo)", dt:'a.InputDT', q: pbsbsbtrade},
	pcoclient: {k: 'AMF.AccNo', q: pcoclient},
	pcotrade: {k: 'UDNo', dt:'InputDT', q: pcotrade},
        ankclient: {k: 'a.AccNo', q: ankclient},
        anktrade: {k: 'r.UDNo', dt:'a.InputDT', q: anktrade},
        ankbktrade: {k: "('BK'+r.UDNo)", dt:'a.InputDT', q: ankbktrade},
        ankbdtrade: {k: "('BD'+r.UDNo)", dt:'a.InputDT', q: ankbdtrade},
        anksbtrade: {k: "('SB'+r.UDNo)", dt:'a.InputDT', q: anksbtrade},
        afrclient: {k: 'a.AccNo', q: afrclient},
        afrtrade: {k: 'd.UDNo', dt:'a.InputDT', q: afrtrade},
        afrsbtrade: {k: "d.UDNo", dt:'a.InputDT', q: afrsbtrade}
}
            

module.exports = {
	Sqlqueries: Sqlqueries
};

